import{_ as t,c as n,d as a,o as i}from"./app-mpVIenb5.js";const s={};function r(o,e){return i(),n("div",null,e[0]||(e[0]=[a('<h1 id="syncassignmentdeleted" tabindex="-1"><a class="header-anchor" href="#syncassignmentdeleted"><span>syncAssignmentDeleted()</span></a></h1><h4 id="syncassignmentdeleted-1" tabindex="-1"><a class="header-anchor" href="#syncassignmentdeleted-1"><span><a href="https://github.com/yeatmanlab/roar-firebase-functions/blob/e784650492722d24069aa9b0704d1873ea5dafee/gse-roar-admin/functions/src/index.ts#L520" target="_blank" rel="noopener noreferrer">syncAssignmentDeleted</a></span></a></h4><h3 id="function-name" tabindex="-1"><a class="header-anchor" href="#function-name"><span>Function Name</span></a></h3><p><code>syncAssignmentDeleted</code></p><h3 id="trigger" tabindex="-1"><a class="header-anchor" href="#trigger"><span>Trigger</span></a></h3><p>This Cloud Function is triggered by the deletion of a document within the Firestore path <code>users/{roarUid}/assignments/{assignmentUid}</code>. It monitors for document deletions to manage related data clean-up and synchronization tasks effectively.</p><h3 id="operation" tabindex="-1"><a class="header-anchor" href="#operation"><span>Operation</span></a></h3><p>Upon detecting the deletion of an assignment document, the function performs several key operations using Firestore transactions:</p><ol><li><p><strong>Retrieval of Deleted Document Data</strong>:</p><ul><li>Captures data from the deleted assignment document for use in updating related metrics.</li></ul></li><li><p><strong>Update of Assignment Metrics</strong>:</p><ul><li>Accesses the <code>administrations</code> document related to the deleted assignment to update assignment-related statistics such as &quot;assigned&quot;, &quot;started&quot;, and &quot;completed&quot; counters.</li><li>Decrements the respective counters based on the data from the deleted assignment: <ul><li><strong>Assigned Counter</strong>: Decremented for each organization listed in the assignment&#39;s data and for the total.</li><li><strong>Started Counter</strong>: Only decremented for tasks that were marked as started.</li><li><strong>Completed Counter</strong>: Only decremented for tasks that were marked as completed, considering whether the entire assignment was previously marked as completed.</li></ul></li></ul></li><li><p><strong>Update of User Document</strong>:</p><ul><li>Updates the user&#39;s document to remove references to the deleted assignment, specifically deleting dates related to the assignment and removing the assignment ID from arrays tracking assignments&#39; statuses.</li></ul></li></ol><h3 id="detailed-workflow" tabindex="-1"><a class="header-anchor" href="#detailed-workflow"><span>Detailed Workflow</span></a></h3><ul><li><p><strong>Document Deletion Event</strong>: Captures the event where an assignment document under a user profile is deleted.</p></li><li><p><strong>Transaction Execution</strong>:</p><ul><li><strong>Retrieval of Previous Data</strong>: Fetches data from the deleted document to guide updates.</li><li><strong>Metric Adjustments</strong>: Utilizes helper functions to decrement status counters in the <code>administrations/stats</code> collection based on the data from the deleted document.</li><li><strong>User Document Update</strong>: Adjusts the user&#39;s document to reflect the removal of the assignment, ensuring that any reference to the deleted assignment is cleared from tracking fields.</li></ul></li></ul><h3 id="error-handling-and-security-considerations" tabindex="-1"><a class="header-anchor" href="#error-handling-and-security-considerations"><span>Error Handling and Security Considerations</span></a></h3><ul><li><p><strong>Error Handling</strong>:</p><ul><li>Implements robust handling of transaction failures and ensures that all operations are retried up to a limit if they fail initially.</li><li>Manages potential inconsistencies that may arise if the deletion event does not provide complete data.</li></ul></li><li><p><strong>Security</strong>:</p><ul><li>Ensures that operations are only triggered by authorized deletions, with checks to prevent unauthorized data manipulation.</li><li>Validates that only existing and accurate data is used to update counters and user profiles, ensuring integrity in data processing.</li></ul></li></ul><h3 id="deployment-and-maintenance" tabindex="-1"><a class="header-anchor" href="#deployment-and-maintenance"><span>Deployment and Maintenance</span></a></h3><p>This function is deployed automatically using GitHub actions, whenever changes are merged into the <code>main</code> branch.</p>',15)]))}const d=t(s,[["render",r],["__file","sync-assignment-deleted.html.vue"]]),c=JSON.parse('{"path":"/developer/cloud-functions/gse-roar-admin/sync-assignment-deleted.html","title":"syncAssignmentDeleted()","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"Function Name","slug":"function-name","link":"#function-name","children":[]},{"level":3,"title":"Trigger","slug":"trigger","link":"#trigger","children":[]},{"level":3,"title":"Operation","slug":"operation","link":"#operation","children":[]},{"level":3,"title":"Detailed Workflow","slug":"detailed-workflow","link":"#detailed-workflow","children":[]},{"level":3,"title":"Error Handling and Security Considerations","slug":"error-handling-and-security-considerations","link":"#error-handling-and-security-considerations","children":[]},{"level":3,"title":"Deployment and Maintenance","slug":"deployment-and-maintenance","link":"#deployment-and-maintenance","children":[]}],"git":{"updatedTime":1743546779000,"contributors":[{"name":"Elijah Kelly","username":"Elijah Kelly","email":"kellyel@stanford.edu","commits":3,"url":"https://github.com/Elijah Kelly"},{"name":"Kyle Montville","username":"Kyle Montville","email":"kmontvil@stanford.edu","commits":1,"url":"https://github.com/Kyle Montville"},{"name":"Adam Richie-Halford","username":"Adam Richie-Halford","email":"richford@users.noreply.github.com","commits":1,"url":"https://github.com/Adam Richie-Halford"},{"name":"Kyle","username":"Kyle","email":"ksmontville@gmail.com","commits":2,"url":"https://github.com/Kyle"}]},"filePathRelative":"developer/cloud-functions/gse-roar-admin/sync-assignment-deleted.md"}');export{d as comp,c as data};
