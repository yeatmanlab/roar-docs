import{_ as s,c as e,d as n,o as t}from"./app-mpVIenb5.js";const o={};function l(i,a){return t(),e("div",null,a[0]||(a[0]=[n(`<h1 id="roar-data-validator-trigger" tabindex="-1"><a class="header-anchor" href="#roar-data-validator-trigger"><span>ROAR Data Validator Trigger</span></a></h1><p>The ROAR Data Validator Trigger is a cloud function which instantiates the ROAR Data Validator function. The trigger uses the Python <code>concurrent.futures</code> module to run the validator function in parallel on multiple cloud function instances. <br> The Data Validator Trigger is used to primarily as a PUB/SUB trigger to validate and upload data to Redivis on a Cloud Scheduler, though it can also be triggered by a POST request to its http endpoint.</p><p>The GitHub repository for the Data Validator Trigger can be found <a href="https://github.com/yeatmanlab/roar-data-validator" target="_blank" rel="noopener noreferrer">here.</a></p><p>The Data Validator Trigger function is deployed on Google Cloud and can be accessed at the following endpoint: <br><code>https://us-central1-gse-roar-admin.cloudfunctions.net/data-validator-trigger</code></p><h2 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters"><span>Parameters</span></a></h2><p>The Data Validator Trigger function is triggered by a POST request to its http endpoint. The POST request may include the following parameters:</p><ul><li><code>lab_ids</code>: A list of lab ids to validate and upload to Redivis.</li><li><code>is_from_firestore</code>: A boolean indicating whether the data is coming from Firestore.</li><li><code>is_save_to_storage</code>: A boolean indicating whether the data should be saved to a Google Cloud Bucket.</li><li><code>is_upload_to_redivis</code>: A boolean indicating whether the data should be uploaded to Redivis.</li><li><code>is_release_to_redivis</code>: A boolean indicating whether the data should be released to Redivis.</li><li><code>is_from_guest</code>: A boolean indicating whether the data is coming from the Firestore <code>guests</code> collection.</li><li><code>is_test</code>: A boolean indicating whether the function is being run in test mode.</li><li><code>is_local</code>: A boolean indicating whether the Data Validator function should be run locally or in the cloud.</li><li><code>is_all_data</code>: A boolean indicating whether the function is being run in all data mode.</li></ul><h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage"><span>Usage</span></a></h2><h3 id="local-mode" tabindex="-1"><a class="header-anchor" href="#local-mode"><span>Local Mode</span></a></h3><p>The Data Validator Trigger can be run locally for testing purposes. This allows you to leverage <code>functions-framework</code> to run the function on a localhost port and pass in a small list of district ids to validate and upload to Redivis.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">functions-framework <span class="token parameter variable">--target</span><span class="token operator">=</span>data_validator_trigger <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">9090</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We set the port to 9090 to avoid conflicts with the Data Validator function which runs on port 8080. <br> If you want to run the Data Validator Trigger locally and trigger the Data Validator function in the cloud, you must run the Data Validator Trigger locally only. <br> If you want a local instance of the Data Validator Trigger to trigger a local instance of the Data Validator function, you must run both functions locally.</p><p>The presence and value of the <code>is_local</code> key in the JSON payload will determine whether the Data Validator Trigger function will trigger the Data Validator function locally or in the cloud. <br> The POST request will fail if the <code>is_local</code> key is <code>true</code> and the Data Validator function is not running locally.</p><h3 id="remote-mode" tabindex="-1"><a class="header-anchor" href="#remote-mode"><span>Remote Mode</span></a></h3><p>Once uploaded to Google Cloud, the Data Validator Trigger can be run remotely by sending a POST request to the Data Validator cloud function. <br> When running remotely, the trigger will invoke a function to grab all district ids and group ids from Firestore and pass them to the Data Validator function. <br> The Data Validator Trigger can be set up in a Cloud Scheduler to run at a specified time in order to validate and upload all Firestore data to Redivis continuously.</p><h2 id="sample-post-requests" tabindex="-1"><a class="header-anchor" href="#sample-post-requests"><span>Sample POST Requests</span></a></h2><h3 id="testing-locally-with-fixed-lab-ids" tabindex="-1"><a class="header-anchor" href="#testing-locally-with-fixed-lab-ids"><span>Testing Locally with Fixed Lab Ids</span></a></h3><p>Make sure that you are running the function locally with <code>functions-framework</code></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">functions-framework <span class="token parameter variable">--target</span><span class="token operator">=</span>data_validator_trigger <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">9090</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>POST</code> <code>http://localhost:9090</code> <br><code>Content-Type: application/json</code> <br><code>API-Key: [REDIVIS API KEY]</code></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span> <span class="token property">&quot;lab_ids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;HQFjwzLOBIgZmNlK4f0q&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5ee2ff39f1eae600014d2a20&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bm6N82WFObiurGAKeJUv&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_firestore&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_save_to_storage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_upload_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_release_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_guest&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_test&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_local&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="testing-locally-with-all-firestore-district-ids" tabindex="-1"><a class="header-anchor" href="#testing-locally-with-all-firestore-district-ids"><span>Testing Locally with all Firestore District Ids</span></a></h3><p>Make sure that you are running the function locally with <code>functions-framework</code></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">functions-framework <span class="token parameter variable">--target</span><span class="token operator">=</span>data_validator_trigger <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">9090</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>POST</code> <code>http://localhost:9090</code> <br><code>Content-Type: application/json</code> <br><code>API-Key: [REDIVIS API KEY]</code></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span> <span class="token property">&quot;lab_ids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_firestore&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_save_to_storage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_upload_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_release_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_guest&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_test&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_local&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="testing-remotely-with-all-firestore-district-ids" tabindex="-1"><a class="header-anchor" href="#testing-remotely-with-all-firestore-district-ids"><span>Testing Remotely with all Firestore District Ids</span></a></h3><p><code>POST</code> <code>https://us-central1-gse-roar-admin.cloudfunctions.net/data-validator-trigger</code> <br><code>Content-Type: application/json</code> <br><code>API-Key: [REDIVIS API KEY]</code></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span> <span class="token property">&quot;lab_ids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_firestore&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_save_to_storage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_upload_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line"><span class="token property">&quot;is_release_to_redivis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_from_guest&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_test&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token property">&quot;is_local&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29)]))}const p=s(o,[["render",l],["__file","data-validator-trigger.html.vue"]]),c=JSON.parse('{"path":"/developer/roar-redivis/data-validator-trigger.html","title":"ROAR Data Validator Trigger","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Parameters","slug":"parameters","link":"#parameters","children":[]},{"level":2,"title":"Usage","slug":"usage","link":"#usage","children":[{"level":3,"title":"Local Mode","slug":"local-mode","link":"#local-mode","children":[]},{"level":3,"title":"Remote Mode","slug":"remote-mode","link":"#remote-mode","children":[]}]},{"level":2,"title":"Sample POST Requests","slug":"sample-post-requests","link":"#sample-post-requests","children":[{"level":3,"title":"Testing Locally with Fixed Lab Ids","slug":"testing-locally-with-fixed-lab-ids","link":"#testing-locally-with-fixed-lab-ids","children":[]},{"level":3,"title":"Testing Locally with all Firestore District Ids","slug":"testing-locally-with-all-firestore-district-ids","link":"#testing-locally-with-all-firestore-district-ids","children":[]},{"level":3,"title":"Testing Remotely with all Firestore District Ids","slug":"testing-remotely-with-all-firestore-district-ids","link":"#testing-remotely-with-all-firestore-district-ids","children":[]}]}],"git":{"updatedTime":1743546779000,"contributors":[{"name":"Elijah Kelly","username":"Elijah Kelly","email":"kellyel@stanford.edu","commits":1,"url":"https://github.com/Elijah Kelly"},{"name":"Kyle","username":"Kyle","email":"ksmontville@gmail.com","commits":2,"url":"https://github.com/Kyle"}]},"filePathRelative":"developer/roar-redivis/data-validator-trigger.md"}');export{p as comp,c as data};
