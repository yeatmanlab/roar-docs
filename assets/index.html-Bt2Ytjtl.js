import{_ as s,c as a,d as e,o as p}from"./app-Ddwicbh1.js";const t="/roar-docs/assets/app-check-debug-token-console-hMitSWfo.png",o="/roar-docs/assets/app-check-manage-debug-tokens-D1aKud84.png",i="/roar-docs/assets/app-check-add-debug-token-sNldvrfa.png",c="/roar-docs/assets/app-check-error-example-DGg8yxLl.png",l={};function r(u,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="firebase-app-check-configuration-for-roar-firekit-and-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#firebase-app-check-configuration-for-roar-firekit-and-roar-dashboard"><span>Firebase App Check Configuration for <code>roar-firekit</code> and <code>roar-dashboard</code></span></a></h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>This document outlines the steps taken to configure App Check for secure access to Firebase services through the <code>roar-dashboard</code> Vue application, which uses the <code>roar-firekit</code> TypeScript package to manage Firebase services.</p><h2 id="what-is-firebase-app-check" tabindex="-1"><a class="header-anchor" href="#what-is-firebase-app-check"><span>What is Firebase App Check?</span></a></h2><p>Firebase App Check is a security feature designed to protect your Firebase resources from unauthorized access by verifying that incoming traffic originates from your app. It helps safeguard against abuse and ensures that only legitimate requests from your app can access your Firebase services, such as Firestore, Realtime Database, Cloud Functions, and Storage.</p><h3 id="how-does-firebase-app-check-work" tabindex="-1"><a class="header-anchor" href="#how-does-firebase-app-check-work"><span>How Does Firebase App Check Work?</span></a></h3><p>App Check works by generating an App Check token on the client side and sending it along with requests to your Firebase backend services. The Firebase backend then verifies this token to ensure that the request is coming from an authenticated and authorized client app.</p><h3 id="enabling-firebase-app-check" tabindex="-1"><a class="header-anchor" href="#enabling-firebase-app-check"><span>Enabling Firebase App Check</span></a></h3><p>To use Firebase App Check, it must be enabled in the Firebase Console for each service you want to protect. You&#39;ll also need to integrate the App Check SDK into your app and configure it with an appropriate provider, such as reCAPTCHA for web apps or DeviceCheck/SafetyNet for mobile apps.</p><p>The App Check web console can be found <a href="https://console.firebase.google.com/u/0/project/gse-roar-admin/appcheck" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 id="monitored-vs-enforced-mode" tabindex="-1"><a class="header-anchor" href="#monitored-vs-enforced-mode"><span>Monitored vs. Enforced Mode</span></a></h3><p>Once App Check is enabled, your project can operate in one of two states:</p><ul><li><p><strong>Monitored Mode</strong>: In this state, App Check is enabled, and requests without valid App Check tokens are allowed but logged. This mode is useful for gradually introducing App Check into your app, as it allows you to monitor traffic and identify any potential issues without disrupting service to legitimate users.</p></li><li><p><strong>Enforced Mode</strong>: In this state, Firebase services strictly require valid App Check tokens for every request. Requests without a valid token are rejected. This mode offers the highest level of security by ensuring that only authenticated requests from your app can access your Firebase resources.</p></li></ul><p>Firebase App Check is a crucial tool for enhancing the security of your Firebase projects. By enabling it and moving from Monitored to Enforced mode, you can protect your app and its users from unauthorized access and abuse, ensuring that only legitimate requests are processed by your Firebase services.</p><h3 id="generating-a-debug-token-for-local-development" tabindex="-1"><a class="header-anchor" href="#generating-a-debug-token-for-local-development"><span>Generating a Debug Token for Local Development</span></a></h3><p>When developing in a local environment, you can use a debug token to bypass App Check verification. This allows you to test your app without having to pass the App Check verification step. The debug token is a private key that should not be exposed or shared publicly.</p><h4 id="steps-to-generate-and-register-a-debug-token" tabindex="-1"><a class="header-anchor" href="#steps-to-generate-and-register-a-debug-token"><span>Steps to Generate and Register a Debug Token</span></a></h4><ol><li><p><strong>Generate the Debug Token:</strong></p><ul><li>Pull the main branch and run the development server:<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">npm</span> run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>Open the developer console, and you will see a message that includes a new debug token. <br><br><img src="`+t+`" alt="Debug Token"></li></ul></li><li><p><strong>Save the Debug Token:</strong></p><ul><li>Save the generated debug token in your <code>.env</code> file:<div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line">VITE_APPCHECK_DEBUG_TOKEN=the-generated-token-from-developer-console</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>Register the Debug Token:</strong></p><ul><li>This token <strong>IS NOT</strong> valid until it is registered on the Firebase web console.</li><li>Register the token on the Firebase App Check console for <strong>BOTH DEVELOPMENT PROJECTS</strong>: <ul><li><a href="https://console.firebase.google.com/u/0/project/gse-roar-admin-dev/appcheck/apps" target="_blank" rel="noopener noreferrer">gse-roar-admin-dev</a></li><li><a href="https://console.firebase.google.com/u/0/project/gse-roar-assessment-dev/appcheck/apps" target="_blank" rel="noopener noreferrer">gse-roar-assessment-dev</a></li></ul></li><li>Click the three-dots menu on the right side of the screen and select <em>&quot;Manage debug tokens&quot;</em>. <br><br><img src="`+o+`" alt="Manage Debug Tokens"></li><li>Within the modal, click <em>&quot;Add debug token&quot;</em>.</li><li>Name the token using the following pattern and copy-paste the generated debug token into the field, then click <em>&quot;Done&quot;</em> to save the changes: <br><br><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext" data-title="plaintext"><pre><code><span class="line">app-check-debug-token-{your-firstname}-{your-lastname}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="`+i+'" alt="Add Debug Token"></li></ul></li><li><p><strong>Verify Local Development Setup:</strong></p><ul><li>You should now be set up to run code on <code>localhost</code> without needing App Check verification.</li><li>Requests made without a valid debug token will fail with the error message attached. <br><br><img src="'+c+`" alt="Invalid Debug Token Error"></li></ul></li></ol><h2 id="environment-setup" tabindex="-1"><a class="header-anchor" href="#environment-setup"><span>Environment Setup</span></a></h2><h3 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables"><span>Environment Variables</span></a></h3><p>Environment variables are set up in the <code>roar-dashboard</code> project to configure App Check tokens that are used by <code>roar-firekit</code>. These variables are managed using <code>.env</code> files in the <code>roar-dashboard</code> project and are prefixed according to Vite&#39;s requirements.</p><ul><li><strong>Vite Configuration</strong>: Since <code>roar-dashboard</code> is bundled with Vite, environment variables are prefixed with <code>VITE_</code> and accessed using <code>import.meta.env</code>.</li></ul><h3 id="example-env-file-in-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#example-env-file-in-roar-dashboard"><span>Example <code>.env</code> File in <code>roar-dashboard</code></span></a></h3><div class="language-env line-numbers-mode" data-highlighter="prismjs" data-ext="env" data-title="env"><pre><code><span class="line">VITE_APPCHECK_DEBUG_TOKEN=your_debug_token_value</span>
<span class="line">VITE_APPCHECK_SITE_KEY=your_site_key_value</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="accessing-environment-variables-in-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#accessing-environment-variables-in-roar-dashboard"><span>Accessing Environment Variables in <code>roar-dashboard</code></span></a></h2><p>In the roar-dashboard Vue app, environment variables are accessed and passed to roar-firekit when initializing Firebase services:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">  appConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&#39;AIzaSyDw0TnTXbvRyoVo5_oa_muhXk9q7783k_g&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">authDomain</span><span class="token operator">:</span> isStaging <span class="token operator">?</span> <span class="token string">&#39;roar-staging.web.app&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;roar.education&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-assessment&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-assessment.appspot.com&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">&#39;757277423033&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">&#39;1:757277423033:web:d6e204ee2dd1047cb77268&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">siteKey</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_GSE_ROAR_ASSESSMENT_APPCHECK_SITE_KEY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">debugToken</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APPCHECK_DEBUG_TOKEN</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  adminConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&#39;AIzaSyBz0CTdyfgNXr7VJqcYOPlG609XDs97Tn8&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">authDomain</span><span class="token operator">:</span> isStaging <span class="token operator">?</span> <span class="token string">&#39;roar-staging.web.app&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;roar.education&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-admin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-admin.appspot.com&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">&#39;1062489366521&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">&#39;1:1062489366521:web:d0b8b5371a67332d1d2728&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">measurementId</span><span class="token operator">:</span> <span class="token string">&#39;G-YYE3YN0S99&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">siteKey</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_GSE_ROAR_ADMIN_APPCHECK_SITE_KEY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">debugToken</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APPCHECK_DEBUG_TOKEN</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="app-check-initialization-in-roar-firekit" tabindex="-1"><a class="header-anchor" href="#app-check-initialization-in-roar-firekit"><span>App Check Initialization in roar-firekit</span></a></h2><p>roar-firekit initializes Firebase and App Check based on the configuration provided by roar-dashboard. App Check tokens are passed as part of the configuration to ensure secure access to Firebase services.</p><h3 id="initialization-of-app-check" tabindex="-1"><a class="header-anchor" href="#initialization-of-app-check"><span>Initialization of App Check</span></a></h3><p>In roar-firekit, the App Check is initialized using the provided siteKey and debugToken:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initializeAppCheckWithRecaptcha</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  app<span class="token operator">:</span> FirebaseApp<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  siteKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> hostname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\\/\\/roar-staging--pr.*-.*\\.web\\.app$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Use the DEBUG reCAPTCHA key for local development and PR deployments</span></span>
<span class="line">  <span class="token comment">// This allows us to bypass the reCAPTCHA domain verification</span></span>
<span class="line">  <span class="token comment">// Debug token is a private key passed in from a .env file and should not be exposed</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>hostname <span class="token operator">===</span> <span class="token string">&#39;localhost&#39;</span> <span class="token operator">||</span> regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span>self <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">FIREBASE_APPCHECK_DEBUG_TOKEN</span> <span class="token operator">=</span> debugToken<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Error setting App Check debug token: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Initializing App Check with reCAPTCHA provider for project &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with site key </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>siteKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">initializeAppCheck</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ReCaptchaEnterpriseProvider</span><span class="token punctuation">(</span>siteKey <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      isTokenAutoRefreshEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Error initializing App Check with reCAPTCHA provider: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="initialization-of-firebase-with-app-check" tabindex="-1"><a class="header-anchor" href="#initialization-of-firebase-with-app-check"><span>Initialization of Firebase with App Check</span></a></h3><p>In roar-firekit, Firebase is initialized with the App Check initialization function from above. The App Check token is then retrieved and passed to the roar-dashboard as <code>appCheckToken</code> for secure access to Firebase services:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initializeAppCheckWithRecaptcha</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  app<span class="token operator">:</span> FirebaseApp<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  siteKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> hostname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\\/\\/roar-staging--pr.*-.*\\.web\\.app$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Use the DEBUG reCAPTCHA key for local development and PR deployments</span></span>
<span class="line">  <span class="token comment">// This allows us to bypass the reCAPTCHA domain verification</span></span>
<span class="line">  <span class="token comment">// Debug token is a private key passed in from a .env file and should not be exposed</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>hostname <span class="token operator">===</span> <span class="token string">&#39;localhost&#39;</span> <span class="token operator">||</span> regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span>self <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">FIREBASE_APPCHECK_DEBUG_TOKEN</span> <span class="token operator">=</span> debugToken<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Error setting App Check debug token: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Initializing App Check with reCAPTCHA provider for project &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with site key </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>siteKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">initializeAppCheck</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ReCaptchaEnterpriseProvider</span><span class="token punctuation">(</span>siteKey <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      isTokenAutoRefreshEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Error initializing App Check with reCAPTCHA provider: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">enum</span> AuthPersistence <span class="token punctuation">{</span></span>
<span class="line">  local <span class="token operator">=</span> <span class="token string">&#39;local&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  session <span class="token operator">=</span> <span class="token string">&#39;session&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  none <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">MarkRawConfig</span> <span class="token punctuation">{</span></span>
<span class="line">  auth<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  db<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  functions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">FirebaseProduct</span> <span class="token operator">=</span> Auth <span class="token operator">|</span> Firestore <span class="token operator">|</span> Functions <span class="token operator">|</span> FirebaseStorage<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> initializeFirebaseProject <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span></span>
<span class="line">  config<span class="token operator">:</span> FirebaseConfig<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  authPersistence <span class="token operator">=</span> AuthPersistence<span class="token punctuation">.</span>session<span class="token punctuation">,</span></span>
<span class="line">  markRawConfig<span class="token operator">:</span> MarkRawConfig <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// App Check reCAPTCHA site keys and debug token</span></span>
<span class="line">  siteKey <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> optionallyMarkRaw <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">FirebaseProduct</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>productKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> productInstance<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_get</span><span class="token punctuation">(</span>markRawConfig<span class="token punctuation">,</span> productKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">markRaw</span><span class="token punctuation">(</span>productInstance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> productInstance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>config <span class="token keyword">as</span> EmulatorFirebaseConfig<span class="token punctuation">)</span><span class="token punctuation">.</span>emulatorPorts<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">initializeApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> projectId<span class="token operator">:</span> config<span class="token punctuation">.</span>projectId<span class="token punctuation">,</span> apiKey<span class="token operator">:</span> config<span class="token punctuation">.</span>apiKey <span class="token punctuation">}</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> ports <span class="token operator">=</span> <span class="token punctuation">(</span>config <span class="token keyword">as</span> EmulatorFirebaseConfig<span class="token punctuation">)</span><span class="token punctuation">.</span>emulatorPorts<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">,</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;functions&#39;</span><span class="token punctuation">,</span> <span class="token function">getFunctions</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;storage&#39;</span><span class="token punctuation">,</span> <span class="token function">getStorage</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">connectFirestoreEmulator</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> ports<span class="token punctuation">.</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">connectFunctionsEmulator</span><span class="token punctuation">(</span>functions<span class="token punctuation">,</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> ports<span class="token punctuation">.</span>functions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> originalInfo <span class="token operator">=</span> <span class="token builtin">console</span><span class="token punctuation">.</span>info<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-empty-function</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function-variable function">info</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">connectAuthEmulator</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://127.0.0.1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ports<span class="token punctuation">.</span>auth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span>info <span class="token operator">=</span> originalInfo<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      firebaseApp<span class="token operator">:</span> app<span class="token punctuation">,</span></span>
<span class="line">      auth<span class="token punctuation">,</span></span>
<span class="line">      db<span class="token punctuation">,</span></span>
<span class="line">      functions<span class="token punctuation">,</span></span>
<span class="line">      storage<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">safeInitializeApp</span><span class="token punctuation">(</span>config <span class="token keyword">as</span> LiveFirebaseConfig<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Initialize App Check with reCAPTCHA provider before calling any other Firebase services</span></span>
<span class="line">    <span class="token comment">// Grab the App Check token for use in the ROAR Dashboard Axios Calls to Firebase</span></span>
<span class="line">    <span class="token keyword">const</span> appCheck <span class="token operator">=</span> <span class="token function">initializeAppCheckWithRecaptcha</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> name<span class="token punctuation">,</span> siteKey<span class="token punctuation">,</span> debugToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> appCheckToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getToken</span><span class="token punctuation">(</span>appCheck<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">,</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;functions&#39;</span><span class="token punctuation">,</span> <span class="token function">getFunctions</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;storage&#39;</span><span class="token punctuation">,</span> <span class="token function">getStorage</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> performance<span class="token operator">:</span> FirebasePerformance <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      performance <span class="token operator">=</span> <span class="token function">getPerformance</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token string">&#39;performance/FB not default&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> kit <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      firebaseApp<span class="token operator">:</span> app<span class="token punctuation">,</span></span>
<span class="line">      appCheckToken<span class="token operator">:</span> appCheckToken<span class="token punctuation">.</span>token<span class="token punctuation">,</span></span>
<span class="line">      auth<span class="token operator">:</span> auth<span class="token punctuation">,</span></span>
<span class="line">      db<span class="token operator">:</span> db<span class="token punctuation">,</span></span>
<span class="line">      functions<span class="token operator">:</span> functions<span class="token punctuation">,</span></span>
<span class="line">      storage<span class="token operator">:</span> storage<span class="token punctuation">,</span></span>
<span class="line">      perf<span class="token operator">:</span> performance<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Auth state persistence is set with \`\`setPersistence\`\` and specifies how a</span></span>
<span class="line">    <span class="token comment">// user session is persisted on a device. We choose in session persistence by</span></span>
<span class="line">    <span class="token comment">// default because many students will access the ROAR on shared devices in the</span></span>
<span class="line">    <span class="token comment">// classroom.</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> browserSessionPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>local<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> browserLocalPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>none<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> inMemoryPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> kit<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="manually-appending-app-check-token-to-axios-requests" tabindex="-1"><a class="header-anchor" href="#manually-appending-app-check-token-to-axios-requests"><span>Manually Appending App Check Token to Axios Requests</span></a></h2><p>Since roar-dashboard uses Axios to make requests to Firebase&#39;s REST API, the App Check token must be manually appended to each request. The App Check token is retrieved from the Roar Firekit config and passed to Axios as a header.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getAxiosInstance <span class="token operator">=</span> <span class="token punctuation">(</span>db <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> unauthenticated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> authStore <span class="token operator">=</span> <span class="token function">useAuthStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> roarfirekit <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>authStore<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> axiosOptions <span class="token operator">=</span> <span class="token function">_get</span><span class="token punctuation">(</span>roarfirekit<span class="token punctuation">.</span>value<span class="token punctuation">.</span>restConfig<span class="token punctuation">,</span> db<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Add appCheckToken to the headers if it exists in the firekit config</span></span>
<span class="line">  <span class="token keyword">const</span> appCheckToken <span class="token operator">=</span> roarfirekit<span class="token punctuation">.</span>value<span class="token punctuation">[</span>db<span class="token punctuation">]</span><span class="token operator">?.</span>appCheckToken<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>appCheckToken<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    axiosOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">...</span>axiosOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&#39;X-Firebase-AppCheck&#39;</span><span class="token operator">:</span> appCheckToken<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>unauthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">delete</span> axiosOptions<span class="token punctuation">.</span>headers<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>axiosOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><ul><li>App Check Token Retrieval: The getAppCheckToken() function in roar-firekit retrieves the current App Check token, ensuring that requests are secure.</li><li>Header Injection: The token is appended to the x-firebase-appcheck header in each Axios request to ensure it is validated by Firebase.</li></ul><p>The integration between roar-dashboard and roar-firekit ensures secure access to Firebase services using App Check. Environment variables are managed using Vite&#39;s import.meta.env, and the App Check token is manually appended to Axios requests to authenticate interactions with Firebase&#39;s REST API. This setup allows for both secure and flexible handling of Firebase services across different environments.</p>`,41)]))}const d=s(l,[["render",r],["__file","index.html.vue"]]),v=JSON.parse('{"path":"/developer/firebase-app-check/","title":"Firebase App Check Configuration for roar-firekit and roar-dashboard","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[]},{"level":2,"title":"What is Firebase App Check?","slug":"what-is-firebase-app-check","link":"#what-is-firebase-app-check","children":[{"level":3,"title":"How Does Firebase App Check Work?","slug":"how-does-firebase-app-check-work","link":"#how-does-firebase-app-check-work","children":[]},{"level":3,"title":"Enabling Firebase App Check","slug":"enabling-firebase-app-check","link":"#enabling-firebase-app-check","children":[]},{"level":3,"title":"Monitored vs. Enforced Mode","slug":"monitored-vs-enforced-mode","link":"#monitored-vs-enforced-mode","children":[]},{"level":3,"title":"Generating a Debug Token for Local Development","slug":"generating-a-debug-token-for-local-development","link":"#generating-a-debug-token-for-local-development","children":[]}]},{"level":2,"title":"Environment Setup","slug":"environment-setup","link":"#environment-setup","children":[{"level":3,"title":"Environment Variables","slug":"environment-variables","link":"#environment-variables","children":[]},{"level":3,"title":"Example .env File in roar-dashboard","slug":"example-env-file-in-roar-dashboard","link":"#example-env-file-in-roar-dashboard","children":[]}]},{"level":2,"title":"Accessing Environment Variables in roar-dashboard","slug":"accessing-environment-variables-in-roar-dashboard","link":"#accessing-environment-variables-in-roar-dashboard","children":[]},{"level":2,"title":"App Check Initialization in roar-firekit","slug":"app-check-initialization-in-roar-firekit","link":"#app-check-initialization-in-roar-firekit","children":[{"level":3,"title":"Initialization of App Check","slug":"initialization-of-app-check","link":"#initialization-of-app-check","children":[]},{"level":3,"title":"Initialization of Firebase with App Check","slug":"initialization-of-firebase-with-app-check","link":"#initialization-of-firebase-with-app-check","children":[]}]},{"level":2,"title":"Manually Appending App Check Token to Axios Requests","slug":"manually-appending-app-check-token-to-axios-requests","link":"#manually-appending-app-check-token-to-axios-requests","children":[]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{"updatedTime":1743546779000,"contributors":[{"name":"Elijah Kelly","username":"Elijah Kelly","email":"kellyel@stanford.edu","commits":1,"url":"https://github.com/Elijah Kelly"},{"name":"Kyle","username":"Kyle","email":"ksmontville@gmail.com","commits":5,"url":"https://github.com/Kyle"}]},"filePathRelative":"developer/firebase-app-check/README.md"}');export{d as comp,v as data};
