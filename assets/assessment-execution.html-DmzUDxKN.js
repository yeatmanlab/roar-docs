import{_ as o,c,a as n,b as a,e,f as r,d as t,r as i,o as u}from"./app-CJ7yTU5J.js";const d={};function k(v,s){const p=i("RouteLink"),l=i("Mermaid");return u(),c("div",null,[s[3]||(s[3]=n("h1",{id:"roar-assessment-execution-technical-specification",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#roar-assessment-execution-technical-specification"},[n("span",null,"ROAR Assessment Execution: Technical Specification")])],-1)),s[4]||(s[4]=n("h2",{id:"purpose-and-scope",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#purpose-and-scope"},[n("span",null,"Purpose and Scope")])],-1)),n("p",null,[s[1]||(s[1]=a("This document defines the runtime and API specification for executing a ROAR task. It details the lifecycle of a task run and defines schema for run and trial data. It relies on the ")),e(p,{to:"/developer/tech-specs/backend/task-configuration.html"},{default:r(()=>s[0]||(s[0]=[a("task configuration technical spec")])),_:1}),s[2]||(s[2]=a(" to define how the system handles parameter resolution and how variant identity and task versioning are used to ensure reproducibility and flexibility."))]),s[5]||(s[5]=t('<h2 id="system-overview" tabindex="-1"><a class="header-anchor" href="#system-overview"><span>System Overview</span></a></h2><h3 id="definitions" tabindex="-1"><a class="header-anchor" href="#definitions"><span>Definitions</span></a></h3><ul><li><strong>Run</strong>: A logged instance of a user executing a task, referencing a variant and task version.</li><li><strong>Trial</strong>: A single interaction within a run (e.g., one item or stimulus-response pair).</li></ul><h3 id="run-lifecycle" tabindex="-1"><a class="header-anchor" href="#run-lifecycle"><span>Run Lifecycle</span></a></h3><ul><li>A run is initiated every time that a task is launched. <ul><li>If it is launched from the ROAR dashboard, the user initiates an interaction to launch the task. The task client then triggers <code>POST /api/runs</code>.</li><li>If it is launched as a standalone web application, the task client generally triggers <code>POST /api/runs</code> immediately on load.</li></ul></li><li>A run may exist in three states: <ul><li><code>in_progress</code></li><li><code>completed</code></li><li><code>abandoned</code></li></ul></li><li>A run is initiated in the <code>in_progress</code> state.</li><li>A run is completed when the user triggers a stopping rule defined by the task (e.g., time limit, all items presented)</li><li>A run is marked abandoned if left <code>in_progress</code> after a period of inactivity (timeout handled by backend job)</li><li>A run may be retried if invalidated (manually or automatically)</li><li>Runs start with <code>reliable = false</code> (a run with zero responses is not reliable) and are patched to <code>reliable = true</code> if the run is validated by the measurement service.</li></ul><h3 id="component-flow-diagram" tabindex="-1"><a class="header-anchor" href="#component-flow-diagram"><span>Component Flow Diagram</span></a></h3>',6)),e(l,{id:"mermaid-99",code:"eJxNkctOwzAQRff9ilmxQVX2LEB9vxCtaBBCVtWaZEotEjuyJy1Sxb8zntI0Oz/OnXtnZl+4U3bQniAddgB66i2gh0D8EoB0+N5At/sIfbVarlNIdGUSX9uwYbYvPwP1WlvIPGrCHE6GDiLbHtEH4yzcw1F7oy1FyUAkQ5UyAZXHgJZt9sYHSiz+EBjCMoJDAUeXNMxVzuacxzXASIBxKxaxSxH+E8Qz5Jp0ZMfCTs4zrtB8gLGwu2h2ELIDlvrpl+EJw/CBQTRT9e7ZMRo3LOnPAmNZIV+cgDO15IbjMG/stkTS0aqlmcIdzEQxvwwh0wWHLlGH2mPJ4wDu+GgylBHPBV2c1+Sqytgv8HWBTJNEXbQCxOXJ/Rr9Wa166WB6W1nyYPIYLnNlVSA3xY+bzh8ngaGU"}),s[6]||(s[6]=t(`<h2 id="sql-schema" tabindex="-1"><a class="header-anchor" href="#sql-schema"><span>SQL Schema</span></a></h2><h3 id="runs" tabindex="-1"><a class="header-anchor" href="#runs"><span>Runs</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> runs <span class="token punctuation">(</span></span>
<span class="line">  id UUID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">DEFAULT</span> gen_random_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  user_id UUID <span class="token keyword">REFERENCES</span> users<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  task_version_id UUID <span class="token keyword">REFERENCES</span> task_versions<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  variant_id UUID <span class="token keyword">REFERENCES</span> variants<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  assignment_id UUID <span class="token keyword">REFERENCES</span> assignments<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  administration_id UUID <span class="token keyword">REFERENCES</span> administrations<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">status</span> <span class="token keyword">TEXT</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">status</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">&#39;in_progress&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;completed&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;abandoned&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  completed_at <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span></span>
<span class="line">  reliable <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  environment_id UUID <span class="token keyword">REFERENCES</span> client_environments<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  created_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  updated_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  deleted_at <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="client-environments" tabindex="-1"><a class="header-anchor" href="#client-environments"><span>Client Environments</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> client_environments <span class="token punctuation">(</span></span>
<span class="line">  id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">  device_type <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  resolution <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  locale <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  user_agent <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  platform <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  touch_capable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span></span>
<span class="line">  created_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  updated_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  deleted_at <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>device_type<span class="token punctuation">,</span> resolution<span class="token punctuation">,</span> locale<span class="token punctuation">,</span> user_agent<span class="token punctuation">,</span> platform<span class="token punctuation">,</span> touch_capable<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="trials" tabindex="-1"><a class="header-anchor" href="#trials"><span>Trials</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> trials <span class="token punctuation">(</span></span>
<span class="line">  id UUID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">DEFAULT</span> gen_random_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  run_id UUID <span class="token keyword">REFERENCES</span> runs<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  trial_index <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  trial_index_in_block <span class="token keyword">INTEGER</span><span class="token punctuation">,</span></span>
<span class="line">  trial_type <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  phase <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  task_id UUID <span class="token keyword">REFERENCES</span> tasks<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  variant_id UUID <span class="token keyword">REFERENCES</span> variants<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  domain <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  corpus_id <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  item_id <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  internal_node_id <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  stimulus <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  distractors JSONB<span class="token punctuation">,</span></span>
<span class="line">  expected_response <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  response <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  button_response <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">  keyboard_response <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  swipe_response <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  response_modality <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  is_correct <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span></span>
<span class="line">  rt <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">  time_elapsed <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">  start_time_unix <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">timestamp</span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span></span>
<span class="line">  timezone <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  audio_feedback <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">  item_parameters JSONB<span class="token punctuation">,</span></span>
<span class="line">  created_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  updated_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  deleted_at <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">Forward compatibility note</p><p>Note: In the future, we will implement <code>items</code>, <code>item_parameters</code>, <code>corpora</code>, and <code>corpora_items</code> tables to normalize item data.</p><ul><li><code>item_id</code> allows future linkage to a normalized item bank but is optional for now. In the future, the item itself will store <code>stimulus</code>, <code>distractors</code>, and <code>expected_response</code>.</li><li><code>stimulus</code>, <code>distractors</code>, <code>expected_response</code> remain for backward compatibility and are passed directly by the task.</li><li>Similarly, <code>item_parameters</code> will be stored in an <code>item_parameters</code> table. For now, <code>item_parameters</code> is supplied by the task and stored in <code>JSONB</code> in the <code>trials</code> table.</li></ul></div><h3 id="trial-metadata-flexible-key-value-store" tabindex="-1"><a class="header-anchor" href="#trial-metadata-flexible-key-value-store"><span>Trial Metadata (Flexible Key-Value Store)</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> trial_metadata <span class="token punctuation">(</span></span>
<span class="line">  id UUID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">DEFAULT</span> gen_random_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  run_id UUID <span class="token keyword">REFERENCES</span> runs<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  trial_id UUID <span class="token keyword">REFERENCES</span> trials<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  user_id UUID <span class="token keyword">REFERENCES</span> users<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  task_id UUID <span class="token keyword">REFERENCES</span> tasks<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  variant_id UUID <span class="token keyword">REFERENCES</span> variants<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">key</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">value</span> JSONB <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  created_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This table is used to record metadata for trial fields not covered by the structured <code>trials</code> schema. It is populated by an &quot;overflow&quot; mechanism in the trials API endpoint. Any fields that begin with <code>ext_</code> will be redirected to this table. Only fields that exist in the <code>trials</code> schema or that begin with <code>ext_</code> will be allowed in trials request payloads.</p><h3 id="run-metadata-flexible-key-value-store" tabindex="-1"><a class="header-anchor" href="#run-metadata-flexible-key-value-store"><span>Run Metadata (Flexible Key-Value Store)</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> run_metadata <span class="token punctuation">(</span></span>
<span class="line">  id UUID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">DEFAULT</span> gen_random_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  run_id UUID <span class="token keyword">REFERENCES</span> runs<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  user_id UUID <span class="token keyword">REFERENCES</span> users<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  task_id UUID <span class="token keyword">REFERENCES</span> tasks<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  variant_id UUID <span class="token keyword">REFERENCES</span> variants<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">key</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">value</span> JSONB <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  created_at <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This table allows for arbitrary metadata to be recorded at the run level. This may include contextual information such as session details, platform capabilities, or experimental flags, especially when not captured by the structured <code>client_environments</code> table. This table is populated by an &quot;overflow&quot; mechanism in the runs API endpoint. Any fields that begin with <code>ext_</code> will be redirected to this table. Only fields that exist in the <code>runs</code> schema or that begin with <code>ext_</code> will be allowed in runs request payloads.</p><h3 id="metadata-registry-view" tabindex="-1"><a class="header-anchor" href="#metadata-registry-view"><span>Metadata Registry View</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> metadata_registry <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  <span class="token keyword">key</span><span class="token punctuation">,</span></span>
<span class="line">  task_id<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> frequency<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">MAX</span><span class="token punctuation">(</span>created_at<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_seen_date</span>
<span class="line"><span class="token keyword">FROM</span> trial_metadata</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">key</span><span class="token punctuation">,</span> task_id<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This view allows developers and researchers to track which custom metadata fields are used across tasks. High-frequency fields may be reviewed for potential inclusion in the core <code>trials</code> schema.</p><h2 id="api-contract" tabindex="-1"><a class="header-anchor" href="#api-contract"><span>API Contract</span></a></h2><h3 id="post-api-runs" tabindex="-1"><a class="header-anchor" href="#post-api-runs"><span><code>POST /api/runs</code></span></a></h3><p>Creates a new run.</p><p>Request:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line">POST /api/runs</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;task_slug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;roar-swr&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;task_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;variant_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Response:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;run_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;task_slug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;roar-swr&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;task_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;variant_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;in_progress&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;num_items&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;shuffle&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;variant_status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="get-api-runs-run-id" tabindex="-1"><a class="header-anchor" href="#get-api-runs-run-id"><span><code>GET /api/runs/{run_id}</code></span></a></h3><p>Returns metadata for a specific run.</p><p>Request:</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http" data-title="http"><pre><code><span class="line">GET /api/runs/12345</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Response:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;run_id&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;task_slug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;swr&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;task_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;variant_id&quot;</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;variant_status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;in_progress&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;num_items&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;shuffle&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="patch-api-runs-run-id" tabindex="-1"><a class="header-anchor" href="#patch-api-runs-run-id"><span><code>PATCH /api/runs/{run_id}</code></span></a></h3><p>Updates a run.</p><h4 id="example-complete-a-run" tabindex="-1"><a class="header-anchor" href="#example-complete-a-run"><span>Example: Complete a run</span></a></h4><p>Request:</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http" data-title="http"><pre><code><span class="line">PATCH /api/runs/12345</span>
<span class="line">{</span>
<span class="line">  &quot;status&quot;: &quot;completed&quot;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Response:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;run_id&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;changes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;in_progress&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;completed&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="example-add-extension-metadata" tabindex="-1"><a class="header-anchor" href="#example-add-extension-metadata"><span>Example: Add extension metadata</span></a></h4><p>Request:</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http" data-title="http"><pre><code><span class="line">PATCH /api/runs/12345</span>
<span class="line">{</span>
<span class="line">  &quot;ext_extension_field_1&quot;: &quot;value&quot;,</span>
<span class="line">  &quot;ext_extension_field_2&quot;: &quot;value&quot;,</span>
<span class="line">  &quot;ext_extension_field_3&quot;: &quot;value&quot;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Response:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;run_id&quot;</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;changes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ext_extension_field_1&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ext_extension_field_2&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ext_extension_field_3&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="post-api-trials" tabindex="-1"><a class="header-anchor" href="#post-api-trials"><span><code>POST /api/trials</code></span></a></h3><p>Creates a new trial.</p><p>Request:</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http" data-title="http"><pre><code><span class="line">POST /api/trials</span>
<span class="line">{</span>
<span class="line">  &quot;run_id&quot;: &quot;12345&quot;,</span>
<span class="line">  &quot;trial_index&quot;: 0,</span>
<span class="line">  &quot;trial_index_in_block&quot;: 0,</span>
<span class="line">  &quot;trial_type&quot;: &quot;item&quot;,</span>
<span class="line">  &quot;phase&quot;: &quot;test&quot;,</span>
<span class="line">  &quot;task_id&quot;: &quot;123&quot;,</span>
<span class="line">  &quot;variant_id&quot;: &quot;123&quot;,</span>
<span class="line">  &quot;domain&quot;: &quot;domain_a&quot;,</span>
<span class="line">  &quot;corpus_id&quot;: &quot;123&quot;,</span>
<span class="line">  &quot;item_id&quot;: &quot;123&quot;,</span>
<span class="line">  &quot;internal_node_id&quot;: &quot;123&quot;,</span>
<span class="line">  &quot;stimulus&quot;: &quot;What is this animal?&quot;,</span>
<span class="line">  &quot;distractors&quot;: [&quot;dog&quot;, &quot;bird&quot;, &quot;fish&quot;],</span>
<span class="line">  &quot;expected_response&quot;: &quot;cat&quot;,</span>
<span class="line">  &quot;item_parameters&quot;: [</span>
<span class="line">    { &quot;model&quot;: &quot;composite&quot;, &quot;a&quot;: 1, &quot;b&quot;: 0, &quot;c&quot;: 0, &quot;d&quot;: 1 },</span>
<span class="line">    { &quot;model&quot;: &quot;sub-domain-a&quot;, &quot;a&quot;: 1, &quot;b&quot;: 0, &quot;c&quot;: 0, &quot;d&quot;: 1 },</span>
<span class="line">    { &quot;model&quot;: &quot;sub-domain-b&quot;, &quot;a&quot;: 1, &quot;b&quot;: 0, &quot;c&quot;: 0, &quot;d&quot;: 1 },</span>
<span class="line">  ],</span>
<span class="line">  &quot;response&quot;: &quot;cat&quot;,</span>
<span class="line">  &quot;button_response&quot;: 1,</span>
<span class="line">  &quot;response_modality&quot;: &quot;button&quot;,</span>
<span class="line">  &quot;is_correct&quot;: true,</span>
<span class="line">  &quot;rt&quot;: 400,</span>
<span class="line">  &quot;time_elapsed&quot;: 400,</span>
<span class="line">  &quot;start_time_unix&quot;: 1694000000,</span>
<span class="line">  &quot;timestamp&quot;: &quot;2023-09-01T00:00:00Z&quot;,</span>
<span class="line">  &quot;timezone&quot;: &quot;UTC&quot;,</span>
<span class="line">  &quot;audio_feedback&quot;: &quot;correct&quot;,</span>
<span class="line">  &quot;ext_extension_field_1&quot;: &quot;value&quot;,</span>
<span class="line">  &quot;ext_extension_field_2&quot;: &quot;value&quot;,</span>
<span class="line">  &quot;ext_extension_field_3&quot;: &quot;value&quot;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Response:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;trial_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="side-effects-and-constraints" tabindex="-1"><a class="header-anchor" href="#side-effects-and-constraints"><span>Side Effects and Constraints</span></a></h2><ul><li>Variants must be created and managed explicitly. Auto-minting of variants is no longer supported.</li><li>Writing unexpected fields to trial or run data will redirect them to the appropriate metadata tables.</li><li>Only published variants may be used in production task runs.</li></ul><h2 id="governance-and-access-controls" tabindex="-1"><a class="header-anchor" href="#governance-and-access-controls"><span>Governance and Access Controls</span></a></h2><ul><li>Any user executing a task may write to <code>trial_metadata</code> or <code>run_metadata</code> through the overflow mechanism</li><li>Admin tools should monitor <code>metadata_registry</code> and allow tagging or discussion of high-frequency fields</li><li>Schema change proposals can reference this registry as justification for extending <code>trials</code> or <code>runs</code> tables</li><li>All overflow metadata keys must begin with <code>ext_</code> to ensure clarity and avoid collisions with future schema fields</li></ul><h2 id="design-rationale" tabindex="-1"><a class="header-anchor" href="#design-rationale"><span>Design Rationale</span></a></h2><ul><li>The <code>client_environments</code> table is kept normalized and strictly typed to ensure deduplication, support grouping analysis, and avoid schema bloat.</li><li>The <code>trial_metadata</code> and <code>run_metadata</code> tables allow for extensible annotations without disrupting the core schema.</li><li>Using the <code>ext_</code> prefix ensures that custom fields are clearly distinguished from standard fields, and encourages teams to maintain namespace hygiene. It prevents accidental proliferation of metadata fields due to misspelling (e.g. &quot;repsonse&quot; instead of &quot;response&quot;).</li><li>Overflow fields are redirected automatically to avoid data loss while preserving schema integrity.</li><li>The <code>metadata_registry</code> view provides visibility into emergent schema usage, enabling governance based on actual field frequency and recency.</li><li>Item-related fields such as <code>stimulus</code>, <code>expected_response</code>, and <code>distractors</code> are retained in the trials table to support current task logic, while <code>item_id</code> and <code>item_parameters</code> are introduced to facilitate a future transition to a normalized item bank with IRT scoring support.</li></ul>`,54))])}const b=o(d,[["render",k],["__file","assessment-execution.html.vue"]]),h=JSON.parse('{"path":"/developer/tech-specs/backend/assessment-execution.html","title":"ROAR Assessment Execution: Technical Specification","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Purpose and Scope","slug":"purpose-and-scope","link":"#purpose-and-scope","children":[]},{"level":2,"title":"System Overview","slug":"system-overview","link":"#system-overview","children":[{"level":3,"title":"Definitions","slug":"definitions","link":"#definitions","children":[]},{"level":3,"title":"Run Lifecycle","slug":"run-lifecycle","link":"#run-lifecycle","children":[]},{"level":3,"title":"Component Flow Diagram","slug":"component-flow-diagram","link":"#component-flow-diagram","children":[]}]},{"level":2,"title":"SQL Schema","slug":"sql-schema","link":"#sql-schema","children":[{"level":3,"title":"Runs","slug":"runs","link":"#runs","children":[]},{"level":3,"title":"Client Environments","slug":"client-environments","link":"#client-environments","children":[]},{"level":3,"title":"Trials","slug":"trials","link":"#trials","children":[]},{"level":3,"title":"Trial Metadata (Flexible Key-Value Store)","slug":"trial-metadata-flexible-key-value-store","link":"#trial-metadata-flexible-key-value-store","children":[]},{"level":3,"title":"Run Metadata (Flexible Key-Value Store)","slug":"run-metadata-flexible-key-value-store","link":"#run-metadata-flexible-key-value-store","children":[]},{"level":3,"title":"Metadata Registry View","slug":"metadata-registry-view","link":"#metadata-registry-view","children":[]}]},{"level":2,"title":"API Contract","slug":"api-contract","link":"#api-contract","children":[{"level":3,"title":"POST /api/runs","slug":"post-api-runs","link":"#post-api-runs","children":[]},{"level":3,"title":"GET /api/runs/{run_id}","slug":"get-api-runs-run-id","link":"#get-api-runs-run-id","children":[]},{"level":3,"title":"PATCH /api/runs/{run_id}","slug":"patch-api-runs-run-id","link":"#patch-api-runs-run-id","children":[]},{"level":3,"title":"POST /api/trials","slug":"post-api-trials","link":"#post-api-trials","children":[]}]},{"level":2,"title":"Side Effects and Constraints","slug":"side-effects-and-constraints","link":"#side-effects-and-constraints","children":[]},{"level":2,"title":"Governance and Access Controls","slug":"governance-and-access-controls","link":"#governance-and-access-controls","children":[]},{"level":2,"title":"Design Rationale","slug":"design-rationale","link":"#design-rationale","children":[]}],"git":{"updatedTime":1751819643000,"contributors":[{"name":"Adam Richie-Halford","username":"Adam Richie-Halford","email":"richiehalford@gmail.com","commits":2,"url":"https://github.com/Adam Richie-Halford"}]},"filePathRelative":"developer/tech-specs/backend/assessment-execution.md"}');export{b as comp,h as data};
