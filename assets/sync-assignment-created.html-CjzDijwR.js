import{_ as n,c as t,d as a,o as i}from"./app-DaI1-wMW.js";const s={};function r(o,e){return i(),t("div",null,e[0]||(e[0]=[a('<h1 id="syncassignmentcreated" tabindex="-1"><a class="header-anchor" href="#syncassignmentcreated"><span>syncAssignmentCreated()</span></a></h1><h4 id="syncassignmentcreated-1" tabindex="-1"><a class="header-anchor" href="#syncassignmentcreated-1"><span><a href="https://github.com/yeatmanlab/roar-firebase-functions/blob/e784650492722d24069aa9b0704d1873ea5dafee/gse-roar-admin/functions/src/index.ts#L441" target="_blank" rel="noopener noreferrer">syncAssignmentCreated</a></span></a></h4><h3 id="function-name" tabindex="-1"><a class="header-anchor" href="#function-name"><span>Function Name</span></a></h3><p><code>syncAssignmentCreated</code></p><h3 id="trigger" tabindex="-1"><a class="header-anchor" href="#trigger"><span>Trigger</span></a></h3><p>This Cloud Function is triggered by the creation of a document within the Firestore path <code>users/{roarUid}/assignments/{assignmentUid}</code>. It specifically listens for new assignments being added under individual user profiles.</p><h3 id="operation" tabindex="-1"><a class="header-anchor" href="#operation"><span>Operation</span></a></h3><p>Upon detecting the creation of an assignment document, the function executes several operations:</p><ol><li><p><strong>Data Retrieval</strong>: It retrieves the newly created assignment&#39;s data from the snapshot provided by the event trigger.</p></li><li><p><strong>Database Transactions</strong>:</p><ul><li><strong>User Document Update</strong>: Updates the user document to include the new assignment in the list of assignments. This is achieved by: <ul><li>Adding the assignment UID to an array field for tracking assigned assignments.</li><li>Storing or updating the date when the assignment was assigned.</li></ul></li><li><strong>Assignment Statistics Update</strong>: Manages statistics related to assignment completion across different organizational contexts within the <code>administrations</code> collection. It updates or increments the &quot;assigned&quot; status for the assignment across various organizational levels and the total count.</li></ul></li><li><p><strong>Logging</strong>: Outputs debug statements to trace the function&#39;s execution and provide insights into the processing stages and any issues encountered.</p></li></ol><h3 id="detailed-workflow" tabindex="-1"><a class="header-anchor" href="#detailed-workflow"><span>Detailed Workflow</span></a></h3><ul><li><p><strong>Assignment Document Creation</strong>:</p><ul><li>Captures the event when a new assignment document is created.</li><li>Extracts necessary details such as <code>roarUid</code>, <code>assignmentUid</code>, and assignment data from the event context and document snapshot.</li></ul></li><li><p><strong>First Transaction</strong>:</p><ul><li>Constructs references to the user&#39;s document.</li><li>Updates the user&#39;s document to reflect the newly assigned assignment, ensuring that the assignment&#39;s presence is recorded and its assigned date is noted.</li></ul></li><li><p><strong>Second Transaction</strong>:</p><ul><li>Accesses the completion stats document related to the assignment.</li><li>Updates the &quot;assigned&quot; counts for the relevant organizational units and the overall total, ensuring that the assignment creation is fully integrated into organizational tracking and statistics.</li></ul></li></ul><h3 id="error-handling-and-security-considerations" tabindex="-1"><a class="header-anchor" href="#error-handling-and-security-considerations"><span>Error Handling and Security Considerations</span></a></h3><ul><li><p><strong>Error Handling</strong>:</p><ul><li>Implements robust transaction handling to manage potential failures in database operations.</li><li>Uses retries and error logging to ensure that each step of the data synchronization is attempted reliably, with detailed logs for diagnosing issues.</li></ul></li><li><p><strong>Security</strong>:</p><ul><li>Ensures that the function operates under authenticated conditions, where only valid and authorized changes trigger data updates.</li><li>Validates data integrity and consistency before applying updates to prevent corrupt or unintended changes from propagating.</li></ul></li></ul><h3 id="deployment-and-maintenance" tabindex="-1"><a class="header-anchor" href="#deployment-and-maintenance"><span>Deployment and Maintenance</span></a></h3><p>This function is deployed automatically using GitHub actions, whenever changes are merged into the <code>main</code> branch.</p>',15)]))}const d=n(s,[["render",r],["__file","sync-assignment-created.html.vue"]]),c=JSON.parse('{"path":"/developer/cloud-functions/gse-roar-admin/sync-assignment-created.html","title":"syncAssignmentCreated()","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"Function Name","slug":"function-name","link":"#function-name","children":[]},{"level":3,"title":"Trigger","slug":"trigger","link":"#trigger","children":[]},{"level":3,"title":"Operation","slug":"operation","link":"#operation","children":[]},{"level":3,"title":"Detailed Workflow","slug":"detailed-workflow","link":"#detailed-workflow","children":[]},{"level":3,"title":"Error Handling and Security Considerations","slug":"error-handling-and-security-considerations","link":"#error-handling-and-security-considerations","children":[]},{"level":3,"title":"Deployment and Maintenance","slug":"deployment-and-maintenance","link":"#deployment-and-maintenance","children":[]}],"git":{"updatedTime":1743546779000,"contributors":[{"name":"Elijah Kelly","username":"Elijah Kelly","email":"kellyel@stanford.edu","commits":3,"url":"https://github.com/Elijah Kelly"},{"name":"Kyle Montville","username":"Kyle Montville","email":"kmontvil@stanford.edu","commits":1,"url":"https://github.com/Kyle Montville"},{"name":"Adam Richie-Halford","username":"Adam Richie-Halford","email":"richford@users.noreply.github.com","commits":1,"url":"https://github.com/Adam Richie-Halford"},{"name":"Kyle","username":"Kyle","email":"ksmontville@gmail.com","commits":2,"url":"https://github.com/Kyle"}]},"filePathRelative":"developer/cloud-functions/gse-roar-admin/sync-assignment-created.md"}');export{d as comp,c as data};
