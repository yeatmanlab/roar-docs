import{_ as a,r as i,o as r,c as s,a as e,b as t,d as o,e as l}from"./app-B1l0_fsE.js";const d={},c=e("h1",{id:"softdeleteuserrun",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#softdeleteuserrun"},[e("span",null,"softDeleteUserRun()")])],-1),u={id:"softdeleteuserrun-createsoftdeletecloudfunction",tabindex:"-1"},h={class:"header-anchor",href:"#softdeleteuserrun-createsoftdeletecloudfunction"},f={href:"https://github.com/yeatmanlab/roar-firebase-functions/blob/e784650492722d24069aa9b0704d1873ea5dafee/gse-roar-assessment/functions/src/index.ts#L33",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/yeatmanlab/roar-firebase-functions/blob/e784650492722d24069aa9b0704d1873ea5dafee/gse-roar-assessment/functions/src/soft-delete.ts#L55",target:"_blank",rel:"noopener noreferrer"},p=l('<h3 id="function-name" tabindex="-1"><a class="header-anchor" href="#function-name"><span>Function Name</span></a></h3><p><code>sotDeleteUserRun</code></p><h4 id="_1-createsoftdeletecloudfunction" tabindex="-1"><a class="header-anchor" href="#_1-createsoftdeletecloudfunction"><span>1. <strong>createSoftDeleteCloudFunction</strong></span></a></h4><p>This utility function dynamically generates Cloud Functions aimed at handling the soft deletion of documents by relocating them to designated &quot;deleted&quot; collections when they are removed from their primary collections. It serves to maintain data integrity by preserving deleted documents in an organized manner.</p><h5 id="operation" tabindex="-1"><a class="header-anchor" href="#operation"><span>Operation</span></a></h5><ul><li><strong>Trigger Configuration</strong>: Utilizes the <code>constructTrigger</code> function to establish a Firestore trigger based on specified collections.</li><li><strong>Document Handling</strong>: Upon the deletion of a document, the generated function transfers the document to a new path within a &quot;deleted&quot; collection, thus preserving its data.</li></ul><h4 id="_2-softdeleteuserrun" tabindex="-1"><a class="header-anchor" href="#_2-softdeleteuserrun"><span>2. <strong>softDeleteUserRun</strong></span></a></h4><p>This specific Cloud Function generated by <code>createSoftDeleteCloudFunction</code> is tailored to handle deletions within the nested structure of <code>users</code> and <code>runs</code> collections. It ensures that run data associated with users is preserved in an orderly fashion after deletion.</p><h3 id="detailed-workflow-and-implementation" tabindex="-1"><a class="header-anchor" href="#detailed-workflow-and-implementation"><span>Detailed Workflow and Implementation</span></a></h3><ul><li><p><strong>Trigger Construction</strong> (<code>constructTrigger</code>):</p><ul><li>Develops a Firestore document path that listens for deletion events within the specified collections. For <code>softDeleteUserRun</code>, it configures a path like <code>users/{doc0}/runs/{doc1}</code>.</li><li>Dynamically assigns path variables (<code>doc0</code>, <code>doc1</code>) to correspond to each collection level involved.</li></ul></li><li><p><strong>Document References Creation</strong> (<code>createDocRefs</code>):</p><ul><li>Generates Firestore document references for both the source (original location) and target (new location within the &quot;deleted&quot; collection) based on the structured document path.</li><li>Ensures that documents are transferred from their active collection locations to appropriately named &quot;deleted&quot; collections.</li></ul></li><li><p><strong>Soft Deletion Handling</strong>:</p><ul><li>When a document deletion is detected, retrieves the document&#39;s data from the source.</li><li>Moves the document data to the target location within the &quot;deleted&quot; collection, ensuring the preservation and archival of data.</li></ul></li></ul><h3 id="error-handling-and-security-considerations" tabindex="-1"><a class="header-anchor" href="#error-handling-and-security-considerations"><span>Error Handling and Security Considerations</span></a></h3><ul><li><p><strong>Error Handling</strong>:</p><ul><li>Robust error management during the document transfer to handle and log any failures, ensuring data is not lost during the operation.</li><li>Accounts for scenarios where document data may be null or missing, providing graceful exits under such conditions.</li></ul></li><li><p><strong>Security</strong>:</p><ul><li>Implements security rules that ensure only authorized deletions prompt the soft deletion process, safeguarding against unauthorized data manipulation.</li><li>Validates document paths and operations to ensure they adhere to security policies and prevent potential vulnerabilities.</li></ul></li></ul><h3 id="deployment-and-maintenance" tabindex="-1"><a class="header-anchor" href="#deployment-and-maintenance"><span>Deployment and Maintenance</span></a></h3><p>This function is deployed automatically using GitHub actions, whenever changes are merged into the <code>main</code> branch.</p>',14);function g(b,y){const n=i("ExternalLinkIcon");return r(),s("div",null,[c,e("h4",u,[e("a",h,[e("span",null,[e("a",f,[t("softDeleteUserRun"),o(n)]),t(", "),e("a",m,[t("createSoftDeleteCloudFunction"),o(n)])])])]),p])}const v=a(d,[["render",g],["__file","soft-delete-user-run.html.vue"]]),w=JSON.parse('{"path":"/cloud-functions/gse-roar-assessment/soft-delete-user-run.html","title":"softDeleteUserRun()","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"Function Name","slug":"function-name","link":"#function-name","children":[]},{"level":3,"title":"Detailed Workflow and Implementation","slug":"detailed-workflow-and-implementation","link":"#detailed-workflow-and-implementation","children":[]},{"level":3,"title":"Error Handling and Security Considerations","slug":"error-handling-and-security-considerations","link":"#error-handling-and-security-considerations","children":[]},{"level":3,"title":"Deployment and Maintenance","slug":"deployment-and-maintenance","link":"#deployment-and-maintenance","children":[]}],"git":{"updatedTime":1714409897000,"contributors":[{"name":"Kyle","email":"ksmontville@gmail.com","commits":1},{"name":"Kyle Montville","email":"kmontvil@stanford.edu","commits":1}]},"filePathRelative":"cloud-functions/gse-roar-assessment/soft-delete-user-run.md"}');export{v as comp,w as data};
