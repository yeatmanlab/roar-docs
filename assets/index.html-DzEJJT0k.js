import{_ as o,c as a,d as s,o as t}from"./app-B3TrGXGt.js";const r={};function n(i,e){return t(),a("div",null,e[0]||(e[0]=[s(`<h1 id="roar-logging" tabindex="-1"><a class="header-anchor" href="#roar-logging"><span>ROAR Logging</span></a></h1><p>Much of the infrastructure that supports ROAR operates on the Google Cloud Platform (GCP), including Firestore, Cloud Functions, and Cloud Scheduler. To monitor and debug these services, we leverage Google Cloud Console, which offers a comprehensive suite of tools for logging and observability.</p><p>Google Cloud Logging is a fully managed service that collects and stores logs from various Google Cloud services. It allows you to search, analyze, monitor, and set up alerts based on log data from both Google Cloud Platform (GCP) and Amazon Web Services (AWS). Logs are centralized, making it easy to search and filter entries from different services.</p><p>You can access the Google Cloud Platform web console <a href="https://console.cloud.google.com/logs" target="_blank" rel="noopener noreferrer">here</a>.</p><p>The console supports structured querying of logs, which is useful for debugging and monitoring services. Logs can be filtered by severity level, resource type, and time range, and they can be exported to Google Cloud Storage, BigQuery, or Pub/Sub for further analysis. Logs can also be saved as local <code>.csv</code> and <code>.json</code> files.</p><p>For more information on Google Cloud Logging query language, refer to the <a href="https://cloud.google.com/logging/docs/view/logging-query-language" target="_blank" rel="noopener noreferrer">documentation</a>.</p><h2 id="cloud-audit-logging" tabindex="-1"><a class="header-anchor" href="#cloud-audit-logging"><span>Cloud Audit Logging</span></a></h2><p>ROAR has enabled Cloud Audit Logs, which provide a record of actions taken by users, service accounts, or APIs that modify resources. These logs are crucial for monitoring and troubleshooting activities within the Google Cloud Platform.</p><p>ROAR currently monitors admin activity, data access, policy denials, and system events for Firebase. These logs are stored in the Cloud Logging service and can be accessed through the Google Cloud Console.</p><p>For more information on Cloud Audit Logging, refer to the <a href="https://cloud.google.com/logging/docs/audit" target="_blank" rel="noopener noreferrer">documentation</a>.</p><h2 id="logging-query-language" tabindex="-1"><a class="header-anchor" href="#logging-query-language"><span>Logging Query Language</span></a></h2><p>The Google Cloud Logging Query Language allows for structured queries on logs. Similar to SQL, it enables filtering and aggregation of logs based on various criteria such as severity level, resource type, and time range. The query language can also be used to create metrics based on log data.</p><p>You can construct queries using either the Google Cloud Console or the Google Cloud CLI.</p><p>Firebase Cloud Audit Logs provide a list of method events logged by Firebase during the execution of a transaction. The complete list of methods logged by Firebase is available <a href="https://cloud.google.com/firestore/docs/audit-logging" target="_blank" rel="noopener noreferrer">here</a>.</p><p>For a deeper understanding of audit logs, including their structure, refer to this <a href="https://cloud.google.com/logging/docs/audit/understanding-audit-logs" target="_blank" rel="noopener noreferrer">guide</a>.</p><h3 id="sample-queries-using-gcloud-cli" tabindex="-1"><a class="header-anchor" href="#sample-queries-using-gcloud-cli"><span>Sample Queries Using gcloud CLI</span></a></h3><p>Hereâ€™s the general structure of the <code>gcloud logging read</code> command for querying Firestore methods in your project (replace <code>METHOD_NAME</code> and <code>LIMIT</code> with the appropriate values):</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.methodName=&quot;METHOD_NAME&quot;&#39;</span> <span class="token parameter variable">--project</span><span class="token operator">=</span>gse-roar-admin <span class="token parameter variable">--limit</span><span class="token operator">=</span>LIMIT</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong><code>resource.type=&quot;audited_resource&quot;</code></strong>: Specifies that the resource type being audited is <code>audited_resource</code>.</li><li><strong><code>logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot;</code></strong>: Filters the log entries to include only Data Access logs for the specified project.</li><li><strong><code>protoPayload.methodName=&quot;METHOD_NAME&quot;</code></strong>: Filters the logs to include only the specified Firestore method.</li><li><strong><code>--limit=LIMIT</code></strong>: Limits the number of log entries returned. Replace <code>LIMIT</code> with the desired number.</li></ul><h4 id="query-for-google-firestore-v1-firestore-getdocument" tabindex="-1"><a class="header-anchor" href="#query-for-google-firestore-v1-firestore-getdocument"><span>Query for <code>google.firestore.v1.Firestore.GetDocument</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.methodName=&quot;google.firestore.v1.Firestore.GetDocument&quot;&#39;</span> <span class="token parameter variable">--project</span><span class="token operator">=</span>gse-roar-admin <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="query-for-google-firestore-v1-firestore-createdocument" tabindex="-1"><a class="header-anchor" href="#query-for-google-firestore-v1-firestore-createdocument"><span>Query for <code>google.firestore.v1.Firestore.CreateDocument</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.methodName=&quot;google.firestore.v1.Firestore.CreateDocument&quot;&#39;</span> <span class="token parameter variable">--project</span><span class="token operator">=</span>gse-roar-admin <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="query-for-google-firestore-v1-firestore-deletedocument" tabindex="-1"><a class="header-anchor" href="#query-for-google-firestore-v1-firestore-deletedocument"><span>Query for <code>google.firestore.v1.Firestore.DeleteDocument</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.methodName=&quot;google.firestore.v1.Firestore.DeleteDocument&quot;&#39;</span> <span class="token parameter variable">--project</span><span class="token operator">=</span>gse-roar-admin <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="adjusting-time-range-optional" tabindex="-1"><a class="header-anchor" href="#adjusting-time-range-optional"><span>Adjusting Time Range (Optional)</span></a></h4><p>To filter logs within a specific time range, add a <code>timestamp</code> filter to the query, as shown in previous examples.</p><h3 id="protopayload-object" tabindex="-1"><a class="header-anchor" href="#protopayload-object"><span>protoPayload Object</span></a></h3><p>In Google Cloud Logging, the <code>protoPayload</code> field contains structured data about the log entry, including details about the request, the response, and the authentication context. Understanding <code>protoPayload</code> is essential for effectively querying and analyzing logs. Below are descriptions and examples of commonly used <code>protoPayload</code> fields:</p><h4 id="protopayload-request" tabindex="-1"><a class="header-anchor" href="#protopayload-request"><span><code>protoPayload.request</code></span></a></h4><p>The <code>protoPayload.request</code> field contains the request parameters sent by the client, which is useful for understanding the specific details of the operation performed.</p><ul><li><p><strong><code>protoPayload.request.name</code></strong>: The name of the resource being accessed.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.request.name=&quot;projects/gse-roar-admin/databases/(default)/documents/users/VqjBqFBh4XOt9E0HdKVbTqfV1aq2&quot;&#39;</span> <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong><code>protoPayload.request.writes.delete</code></strong>: The delete field in the writes object indicates that a document was deleted.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND logName=&quot;projects/gse-roar-admin/logs/cloudaudit.googleapis.com%2Fdata_access&quot; AND protoPayload.request.writes.delete:*&#39;</span> <span class="token parameter variable">--project</span><span class="token operator">=</span>gse-roar-admin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="protopayload-response" tabindex="-1"><a class="header-anchor" href="#protopayload-response"><span><code>protoPayload.response</code></span></a></h4><p>The <code>protoPayload.response</code> field contains the response returned by the server, including the result of the operation. This field is useful for debugging or verifying the outcomes of specific requests.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND protoPayload.response.fields.field_name.stringValue=&quot;desired_value&quot;&#39;</span> <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="protopayload-methodname" tabindex="-1"><a class="header-anchor" href="#protopayload-methodname"><span><code>protoPayload.methodName</code></span></a></h4><p>The <code>protoPayload.methodName</code> field specifies the method that was invoked. This field identifies the type of operation, such as <code>google.firestore.v1.Firestore.GetDocument</code>.</p><ul><li><p><strong><code>google.firestore.v1.Firestore.GetDocument</code></strong>: Retrieves calls to fetch a document from Firestore.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gcloud logging <span class="token builtin class-name">read</span> <span class="token string">&#39;resource.type=&quot;audited_resource&quot; AND protoPayload.methodName=&quot;google.firestore.v1.Firestore.GetDocument&quot;&#39;</span> <span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul>`,38)]))}const d=o(r,[["render",n],["__file","index.html.vue"]]),c=JSON.parse('{"path":"/developer/logging-and-querying/","title":"ROAR Logging","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Cloud Audit Logging","slug":"cloud-audit-logging","link":"#cloud-audit-logging","children":[]},{"level":2,"title":"Logging Query Language","slug":"logging-query-language","link":"#logging-query-language","children":[{"level":3,"title":"Sample Queries Using gcloud CLI","slug":"sample-queries-using-gcloud-cli","link":"#sample-queries-using-gcloud-cli","children":[]},{"level":3,"title":"protoPayload Object","slug":"protopayload-object","link":"#protopayload-object","children":[]}]}],"git":{"updatedTime":1743546779000,"contributors":[{"name":"Elijah Kelly","username":"Elijah Kelly","email":"kellyel@stanford.edu","commits":1,"url":"https://github.com/Elijah Kelly"},{"name":"Kyle","username":"Kyle","email":"ksmontville@gmail.com","commits":1,"url":"https://github.com/Kyle"}]},"filePathRelative":"developer/logging-and-querying/README.md"}');export{d as comp,c as data};
