<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.classList.toggle('dark', true)
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" type="image/png" href="/roar-docs/assets/favicon.png"><title>Firebase App Check Configuration for roar-firekit and roar-dashboard | ROAR Developer Documentation</title><meta name="description" content="Documentation for developers working on the ROAR - Rapid Online Assessment of Reading Project for Yeatmanlab at Stanford University.">
    <link rel="preload" href="/roar-docs/assets/style-DYnKEubK.css" as="style"><link rel="stylesheet" href="/roar-docs/assets/style-DYnKEubK.css">
    <link rel="modulepreload" href="/roar-docs/assets/app-CZL5WUHD.js"><link rel="modulepreload" href="/roar-docs/assets/index.html-Di2ewvuJ.js">
    <link rel="prefetch" href="/roar-docs/assets/index.html-C6plftpH.js" as="script"><link rel="prefetch" href="/roar-docs/assets/auth.html-DHQo8Jb4.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-D0cxXdi5.js" as="script"><link rel="prefetch" href="/roar-docs/assets/audio-optimization.html-DDLewakY.js" as="script"><link rel="prefetch" href="/roar-docs/assets/image-optimization.html-CnwidsI4.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-oyrOxcih.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-QUN75u-O.js" as="script"><link rel="prefetch" href="/roar-docs/assets/score-reports.html-BrIeI-sI.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-CikOeaPX.js" as="script"><link rel="prefetch" href="/roar-docs/assets/admin.html-BVBWYZrp.js" as="script"><link rel="prefetch" href="/roar-docs/assets/assessment.html-Ckp4Onnf.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-BKfbpJr3.js" as="script"><link rel="prefetch" href="/roar-docs/assets/dashboard-integration.html-DbY9xo-A.js" as="script"><link rel="prefetch" href="/roar-docs/assets/monitoring-and-testing.html-1BRaIulC.js" as="script"><link rel="prefetch" href="/roar-docs/assets/preparing-the-app.html-B8CZavf6.js" as="script"><link rel="prefetch" href="/roar-docs/assets/publishing-to-npm.html-BmsgCP5W.js" as="script"><link rel="prefetch" href="/roar-docs/assets/secrets-overview.html-sfu7hvC4.js" as="script"><link rel="prefetch" href="/roar-docs/assets/Fluency.html-CjeZDmJq.js" as="script"><link rel="prefetch" href="/roar-docs/assets/Letter.html-vo1S-cIf.js" as="script"><link rel="prefetch" href="/roar-docs/assets/PA.html-CG2S4FRL.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-BtduW9O1.js" as="script"><link rel="prefetch" href="/roar-docs/assets/SRE.html-CyjVhJ7B.js" as="script"><link rel="prefetch" href="/roar-docs/assets/SWR.html-DODzoB4X.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-DQbZcO7K.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-vbu5_ZG0.js" as="script"><link rel="prefetch" href="/roar-docs/assets/data-validator-trigger.html-DtbQ5E2g.js" as="script"><link rel="prefetch" href="/roar-docs/assets/data-validator.html-vo9YgWTy.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-CNcO5vAw.js" as="script"><link rel="prefetch" href="/roar-docs/assets/assignment-creation.html-B-t4F8hD.js" as="script"><link rel="prefetch" href="/roar-docs/assets/authentication.html-Do_XB-x8.js" as="script"><link rel="prefetch" href="/roar-docs/assets/creating-users.html-C3K_zL9B.js" as="script"><link rel="prefetch" href="/roar-docs/assets/roster-changes.html-di3GW7Yl.js" as="script"><link rel="prefetch" href="/roar-docs/assets/test-clever-users.html-8cPSCG8R.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-D7zZWVBa.js" as="script"><link rel="prefetch" href="/roar-docs/assets/append-to-admin-claims.html-DMHowxhM.js" as="script"><link rel="prefetch" href="/roar-docs/assets/associate-assessment-uid.html-C2TCO3gr.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-administrator-account.html-CIbk0MGc.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-guest-docs-for-google-users.html-RbHp29DP.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-levante-group.html-DohlHcAt.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-levante-users.html-zFHAT9Cl.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-new-family.html-CY18-_bc.js" as="script"><link rel="prefetch" href="/roar-docs/assets/create-student-account.html-CwbcQvRE.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-classes.html-CzbmO4fz.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-custom-claims.html-B0kPsKX3.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-districts.html-BBKiWsa-.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-families.html-U1XCrFSn.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-groups.html-6ld_7ORE.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mirror-schools.html-ZIGPR3FB.js" as="script"><link rel="prefetch" href="/roar-docs/assets/remove-from-admin-claims.html-BDQhrtKG.js" as="script"><link rel="prefetch" href="/roar-docs/assets/save-survey-responses.html-DhWw9d1p.js" as="script"><link rel="prefetch" href="/roar-docs/assets/set-uid-custom-claims.html-2dFghOgn.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-user-assignment.html-DcY40WMx.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-user-external-data.html-sYOplVAK.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-user.html-y5qcwXRr.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-assignment-created.html-D8kb9YsN.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-assignment-deleted.html-DzafngFL.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-assignment-updated.html-D49Ln9Tm.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-assignments-on-administration-update.html-M47MAhQt.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-assignments-on-user-update.html-eEgXMjIX.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-clever-orgs.html-DXJvHnWf.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-clever-user.html-BLL0BZ2O.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-DrOWn1C9.js" as="script"><link rel="prefetch" href="/roar-docs/assets/organize-bucket-logs-by-date.html-DeCmCZEW.js" as="script"><link rel="prefetch" href="/roar-docs/assets/set-uid-claims.html-Cgtuad8k.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-guest-trial.html-C1V1Xr1M.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-guest.html-Cv7MCAxY.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-user-run.html-BkyILWkN.js" as="script"><link rel="prefetch" href="/roar-docs/assets/soft-delete-user-trial.html-DMHD1l_j.js" as="script"><link rel="prefetch" href="/roar-docs/assets/sync-on-run-doc-update.html-DQGY-AAI.js" as="script"><link rel="prefetch" href="/roar-docs/assets/index.html-D2zY_Hzl.js" as="script"><link rel="prefetch" href="/roar-docs/assets/404.html-B5NfGUe8.js" as="script"><link rel="prefetch" href="/roar-docs/assets/mermaid.core-vcRvbccK.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/roar-docs/"><img class="vp-site-logo" src="/roar-docs/assets/roar-logo-short.svg" alt="ROAR Developer Documentation"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">ROAR Developer Documentation</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/databases/" aria-label="Databases"><!---->Databases<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/workflows/" aria-label="Workflows"><!---->Workflows<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/application/" aria-label="Application"><!---->Application<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/dashboard-components/" aria-label="Dashboard Components"><!---->Dashboard Components<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/roar-docs/firebase-app-check/" aria-label="Firebase App Check"><!---->Firebase App Check<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/cloud-functions/" aria-label="Cloud Functions"><!---->Cloud Functions<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/internationalization/" aria-label="Internationalization"><!---->Internationalization<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/integrating-new-apps/" aria-label="Integrating New Apps"><!---->Integrating New Apps<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/assets-optimization/" aria-label="Optimizing Assets"><!---->Optimizing Assets<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/roar-redivis/" aria-label="ROAR Redivis Instance"><!---->ROAR Redivis Instance<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/logging-and-querying/" aria-label="Logging and Querying"><!---->Logging and Querying<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/yeatmanlab/" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Documentation"><span class="title">Documentation</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/databases/" aria-label="Databases"><!---->Databases<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/workflows/" aria-label="Workflows"><!---->Workflows<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/application/" aria-label="Application"><!---->Application<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/dashboard-components/" aria-label="Dashboard Components"><!---->Dashboard Components<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/roar-docs/firebase-app-check/" aria-label="Firebase App Check"><!---->Firebase App Check<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/cloud-functions/" aria-label="Cloud Functions"><!---->Cloud Functions<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/internationalization/" aria-label="Internationalization"><!---->Internationalization<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/integrating-new-apps/" aria-label="Integrating New Apps"><!---->Integrating New Apps<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/assets-optimization/" aria-label="Optimizing Assets"><!---->Optimizing Assets<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/roar-redivis/" aria-label="ROAR Redivis Instance"><!---->ROAR Redivis Instance<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/roar-docs/logging-and-querying/" aria-label="Logging and Querying"><!---->Logging and Querying<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/yeatmanlab/" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/databases/" aria-label="Databases"><!---->Databases<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/databases/" aria-label="Database Information"><!---->Database Information<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/databases/admin.html" aria-label="gse-roar-admin"><!---->gse-roar-admin<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/databases/assessment.html" aria-label="gse-roar-assessment"><!---->gse-roar-assessment<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/workflows/" aria-label="Workflows"><!---->Workflows<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/" aria-label="Workflows"><!---->Workflows<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/assignment-creation.html" aria-label="Creating an Assignment"><!---->Creating an Assignment<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/authentication.html" aria-label="Authentication"><!---->Authentication<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/creating-users.html" aria-label="Creating new Users"><!---->Creating new Users<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/roster-changes.html" aria-label="User Roster Changes"><!---->User Roster Changes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/workflows/test-clever-users.html" aria-label="How to Impersonate a Clever User on Localhost"><!---->How to Impersonate a Clever User on Localhost<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Application <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/application/auth.html" aria-label="Auth"><!---->Auth<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/dashboard-components/" aria-label="Dashboard Components"><!---->Dashboard Components<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/dashboard-components/" aria-label="Dashboard Components"><!---->Dashboard Components<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/dashboard-components/score-reports.html" aria-label="Organization Score Reports"><!---->Organization Score Reports<!----></a><!----></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/roar-docs/firebase-app-check/" aria-label="Firebase App Check"><!---->Firebase App Check<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/roar-docs/firebase-app-check/" aria-label="Firebase App Check Configuration for roar-firekit and roar-dashboard"><!---->Firebase App Check Configuration for roar-firekit and roar-dashboard<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/cloud-functions/" aria-label="Cloud Functions"><!---->Cloud Functions<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/" aria-label="gse-roar-admin"><!---->gse-roar-admin<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/" aria-label="Admin Database"><!---->Admin Database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/append-to-admin-claims.html" aria-label="appendToAdminClaims()"><!---->appendToAdminClaims()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/associate-assessment-uid.html" aria-label="associateassessmentuid()"><!---->associateassessmentuid()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-administrator-account.html" aria-label="createAdministratorAccount()"><!---->createAdministratorAccount()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-guest-docs-for-google-users.html" aria-label="createGuestDocsForGoogleUsers()"><!---->createGuestDocsForGoogleUsers()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-levante-group.html" aria-label="createLevanteGroup()"><!---->createLevanteGroup()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-levante-users.html" aria-label="createLevanteUsers()"><!---->createLevanteUsers()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-new-family.html" aria-label="createnewfamily()"><!---->createnewfamily()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/create-student-account.html" aria-label="createstudentaccount()"><!---->createstudentaccount()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-classes.html" aria-label="mirrorClasses()"><!---->mirrorClasses()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-custom-claims.html" aria-label="mirrorCustomClaims"><!---->mirrorCustomClaims<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-districts.html" aria-label="mirrorDistricts()"><!---->mirrorDistricts()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-families.html" aria-label="mirrorFamilies()"><!---->mirrorFamilies()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-groups.html" aria-label="mirrorGroups()"><!---->mirrorGroups()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/mirror-schools.html" aria-label="mirrorSchools()"><!---->mirrorSchools()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/remove-from-admin-claims.html" aria-label="removefromadminclaims()"><!---->removefromadminclaims()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/save-survey-responses.html" aria-label="saveSurveyResponses()"><!---->saveSurveyResponses()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/set-uid-custom-claims.html" aria-label="setuidcustomclaims()"><!---->setuidcustomclaims()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/soft-delete-user-assignment.html" aria-label="softDeleteUserAssignment()"><!---->softDeleteUserAssignment()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/soft-delete-user-external-data.html" aria-label="softDeleteUserExternalData"><!---->softDeleteUserExternalData<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/soft-delete-user.html" aria-label="softDeleteUser()"><!---->softDeleteUser()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-assignment-created.html" aria-label="syncAssignmentCreated()"><!---->syncAssignmentCreated()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-assignment-deleted.html" aria-label="syncAssignmentDeleted()"><!---->syncAssignmentDeleted()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-assignment-updated.html" aria-label="syncAssignmentUpdated()"><!---->syncAssignmentUpdated()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-assignments-on-administration-update.html" aria-label="syncAssignmentsOnAdministrationUpdate()"><!---->syncAssignmentsOnAdministrationUpdate()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-assignments-on-user-update.html" aria-label="syncAssignmentsOnUserUpdate()"><!---->syncAssignmentsOnUserUpdate()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-clever-orgs.html" aria-label="syncCleverOrgs()"><!---->syncCleverOrgs()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-admin/sync-clever-user.html" aria-label="syncCleverUser()"><!---->syncCleverUser()<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/" aria-label="gse-roar-assessment"><!---->gse-roar-assessment<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/" aria-label="Assessment Database"><!---->Assessment Database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/organize-bucket-logs-by-date.html" aria-label="organizeBucketLogsByDate()"><!---->organizeBucketLogsByDate()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/set-uid-claims.html" aria-label="setuidclaims()"><!---->setuidclaims()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/soft-delete-guest-trial.html" aria-label="softDeleteGuestTrial()"><!---->softDeleteGuestTrial()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/soft-delete-guest.html" aria-label="softDeleteGuest()"><!---->softDeleteGuest()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/soft-delete-user-run.html" aria-label="softDeleteUserRun()"><!---->softDeleteUserRun()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/soft-delete-user-trial.html" aria-label="softDeleteUserTrial()"><!---->softDeleteUserTrial()<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/cloud-functions/gse-roar-assessment/sync-on-run-doc-update.html" aria-label="syncOnRunDocUpdate()"><!---->syncOnRunDocUpdate()<!----></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/internationalization/" aria-label="Internationalization"><!---->Internationalization<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/Fluency.html" aria-label="ROAM Fluency"><!---->ROAM Fluency<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/Letter.html" aria-label="ROAR Letter"><!---->ROAR Letter<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/PA.html" aria-label="ROAR Phoneme"><!---->ROAR Phoneme<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/" aria-label="Internationalization of ROAR Apps"><!---->Internationalization of ROAR Apps<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/SRE.html" aria-label="ROAR Sentence"><!---->ROAR Sentence<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/internationalization/SWR.html" aria-label="ROAR Word"><!---->ROAR Word<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/integrating-new-apps/" aria-label="Integrating New Apps"><!---->Integrating New Apps<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/" aria-label="Integrating Roar Apps into the Dashboard"><!---->Integrating Roar Apps into the Dashboard<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/dashboard-integration.html" aria-label="Dashboard Integration"><!---->Dashboard Integration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/monitoring-and-testing.html" aria-label="Monitoring and Testing"><!---->Monitoring and Testing<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/preparing-the-app.html" aria-label="Preparing the App for Packaging and Deployment"><!---->Preparing the App for Packaging and Deployment<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/publishing-to-npm.html" aria-label="Packaging and Publishing to npm"><!---->Packaging and Publishing to npm<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/integrating-new-apps/secrets-overview.html" aria-label="Secrets in the GitHub Repository"><!---->Secrets in the GitHub Repository<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/assets-optimization/" aria-label="Assets Optimization"><!---->Assets Optimization<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/assets-optimization/" aria-label="Optimizing Assets"><!---->Optimizing Assets<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/assets-optimization/audio-optimization.html" aria-label="Audio Optimization Guide"><!---->Audio Optimization Guide<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/assets-optimization/image-optimization.html" aria-label="Image Optimization Guide"><!---->Image Optimization Guide<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/roar-redivis/" aria-label="ROAR Redivis Instance"><!---->ROAR Redivis Instance<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/roar-redivis/" aria-label="ROAR Redivis Instance"><!---->ROAR Redivis Instance<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/roar-redivis/data-validator-trigger.html" aria-label="ROAR Data Validator Trigger"><!---->ROAR Data Validator Trigger<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/roar-redivis/data-validator.html" aria-label="ROAR Data Validator"><!---->ROAR Data Validator<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/roar-docs/logging-and-querying-and-querying/" aria-label="Logging and Querying"><!---->Logging and Querying<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/roar-docs/logging-and-querying/" aria-label="ROAR Logging"><!---->ROAR Logging<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="firebase-app-check-configuration-for-roar-firekit-and-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#firebase-app-check-configuration-for-roar-firekit-and-roar-dashboard"><span>Firebase App Check Configuration for <code>roar-firekit</code> and <code>roar-dashboard</code></span></a></h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>This document outlines the steps taken to configure App Check for secure access to Firebase services through the <code>roar-dashboard</code> Vue application, which uses the <code>roar-firekit</code> TypeScript package to manage Firebase services.</p><h2 id="what-is-firebase-app-check" tabindex="-1"><a class="header-anchor" href="#what-is-firebase-app-check"><span>What is Firebase App Check?</span></a></h2><p>Firebase App Check is a security feature designed to protect your Firebase resources from unauthorized access by verifying that incoming traffic originates from your app. It helps safeguard against abuse and ensures that only legitimate requests from your app can access your Firebase services, such as Firestore, Realtime Database, Cloud Functions, and Storage.</p><h3 id="how-does-firebase-app-check-work" tabindex="-1"><a class="header-anchor" href="#how-does-firebase-app-check-work"><span>How Does Firebase App Check Work?</span></a></h3><p>App Check works by generating an App Check token on the client side and sending it along with requests to your Firebase backend services. The Firebase backend then verifies this token to ensure that the request is coming from an authenticated and authorized client app.</p><h3 id="enabling-firebase-app-check" tabindex="-1"><a class="header-anchor" href="#enabling-firebase-app-check"><span>Enabling Firebase App Check</span></a></h3><p>To use Firebase App Check, it must be enabled in the Firebase Console for each service you want to protect. You&#39;ll also need to integrate the App Check SDK into your app and configure it with an appropriate provider, such as reCAPTCHA for web apps or DeviceCheck/SafetyNet for mobile apps.</p><p>The App Check web console can be found <a href="https://console.firebase.google.com/u/0/project/gse-roar-admin/appcheck" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 id="monitored-vs-enforced-mode" tabindex="-1"><a class="header-anchor" href="#monitored-vs-enforced-mode"><span>Monitored vs. Enforced Mode</span></a></h3><p>Once App Check is enabled, your project can operate in one of two states:</p><ul><li><p><strong>Monitored Mode</strong>: In this state, App Check is enabled, and requests without valid App Check tokens are allowed but logged. This mode is useful for gradually introducing App Check into your app, as it allows you to monitor traffic and identify any potential issues without disrupting service to legitimate users.</p></li><li><p><strong>Enforced Mode</strong>: In this state, Firebase services strictly require valid App Check tokens for every request. Requests without a valid token are rejected. This mode offers the highest level of security by ensuring that only authenticated requests from your app can access your Firebase resources.</p></li></ul><p>Firebase App Check is a crucial tool for enhancing the security of your Firebase projects. By enabling it and moving from Monitored to Enforced mode, you can protect your app and its users from unauthorized access and abuse, ensuring that only legitimate requests are processed by your Firebase services.</p><h3 id="generating-a-debug-token-for-local-development" tabindex="-1"><a class="header-anchor" href="#generating-a-debug-token-for-local-development"><span>Generating a Debug Token for Local Development</span></a></h3><p>When developing in a local environment, you can use a debug token to bypass App Check verification. This allows you to test your app without having to pass the App Check verification step. The debug token is a private key that should not be exposed or shared publicly.</p><h4 id="steps-to-generate-and-register-a-debug-token" tabindex="-1"><a class="header-anchor" href="#steps-to-generate-and-register-a-debug-token"><span>Steps to Generate and Register a Debug Token</span></a></h4><ol><li><p><strong>Generate the Debug Token:</strong></p><ul><li>Pull the main branch and run the development server:<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">npm</span> run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>Open the developer console, and you will see a message that includes a new debug token. <br><br><img src="/roar-docs/assets/app-check-debug-token-console-hMitSWfo.png" alt="Debug Token"></li></ul></li><li><p><strong>Save the Debug Token:</strong></p><ul><li>Save the generated debug token in your <code>.env</code> file:<div class="language-dotenv line-numbers-mode" data-highlighter="prismjs" data-ext="dotenv" data-title="dotenv"><pre><code><span class="line">VITE_APPCHECK_DEBUG_TOKEN=the-generated-token-from-developer-console</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>Register the Debug Token:</strong></p><ul><li>This token <strong>IS NOT</strong> valid until it is registered on the Firebase web console.</li><li>Register the token on the Firebase App Check console for <strong>BOTH DEVELOPMENT PROJECTS</strong>: <ul><li><a href="https://console.firebase.google.com/u/0/project/gse-roar-admin-dev/appcheck/apps" target="_blank" rel="noopener noreferrer">gse-roar-admin-dev</a></li><li><a href="https://console.firebase.google.com/u/0/project/gse-roar-assessment-dev/appcheck/apps" target="_blank" rel="noopener noreferrer">gse-roar-assessment-dev</a></li></ul></li><li>Click the three-dots menu on the right side of the screen and select <em>&quot;Manage debug tokens&quot;</em>. <br><br><img src="/roar-docs/assets/app-check-manage-debug-tokens-D1aKud84.png" alt="Manage Debug Tokens"></li><li>Within the modal, click <em>&quot;Add debug token&quot;</em>.</li><li>Name the token using the following pattern and copy-paste the generated debug token into the field, then click <em>&quot;Done&quot;</em> to save the changes: <br><br><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext" data-title="plaintext"><pre><code><span class="line">app-check-debug-token-{your-firstname}-{your-lastname}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="/roar-docs/assets/app-check-add-debug-token-sNldvrfa.png" alt="Add Debug Token"></li></ul></li><li><p><strong>Verify Local Development Setup:</strong></p><ul><li>You should now be set up to run code on <code>localhost</code> without needing App Check verification.</li><li>Requests made without a valid debug token will fail with the error message attached. <br><br><img src="/roar-docs/assets/app-check-error-example-DGg8yxLl.png" alt="Invalid Debug Token Error"></li></ul></li></ol><h2 id="environment-setup" tabindex="-1"><a class="header-anchor" href="#environment-setup"><span>Environment Setup</span></a></h2><h3 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables"><span>Environment Variables</span></a></h3><p>Environment variables are set up in the <code>roar-dashboard</code> project to configure App Check tokens that are used by <code>roar-firekit</code>. These variables are managed using <code>.env</code> files in the <code>roar-dashboard</code> project and are prefixed according to Vite&#39;s requirements.</p><ul><li><strong>Vite Configuration</strong>: Since <code>roar-dashboard</code> is bundled with Vite, environment variables are prefixed with <code>VITE_</code> and accessed using <code>import.meta.env</code>.</li></ul><h3 id="example-env-file-in-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#example-env-file-in-roar-dashboard"><span>Example <code>.env</code> File in <code>roar-dashboard</code></span></a></h3><div class="language-env line-numbers-mode" data-highlighter="prismjs" data-ext="env" data-title="env"><pre><code><span class="line">VITE_APPCHECK_DEBUG_TOKEN=your_debug_token_value</span>
<span class="line">VITE_APPCHECK_SITE_KEY=your_site_key_value</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="accessing-environment-variables-in-roar-dashboard" tabindex="-1"><a class="header-anchor" href="#accessing-environment-variables-in-roar-dashboard"><span>Accessing Environment Variables in <code>roar-dashboard</code></span></a></h2><p>In the roar-dashboard Vue app, environment variables are accessed and passed to roar-firekit when initializing Firebase services:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">  appConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&#39;AIzaSyDw0TnTXbvRyoVo5_oa_muhXk9q7783k_g&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">authDomain</span><span class="token operator">:</span> isStaging <span class="token operator">?</span> <span class="token string">&#39;roar-staging.web.app&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;roar.education&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-assessment&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-assessment.appspot.com&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">&#39;757277423033&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">&#39;1:757277423033:web:d6e204ee2dd1047cb77268&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">siteKey</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_GSE_ROAR_ASSESSMENT_APPCHECK_SITE_KEY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">debugToken</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APPCHECK_DEBUG_TOKEN</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  adminConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&#39;AIzaSyBz0CTdyfgNXr7VJqcYOPlG609XDs97Tn8&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">authDomain</span><span class="token operator">:</span> isStaging <span class="token operator">?</span> <span class="token string">&#39;roar-staging.web.app&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;roar.education&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">projectId</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-admin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">storageBucket</span><span class="token operator">:</span> <span class="token string">&#39;gse-roar-admin.appspot.com&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">messagingSenderId</span><span class="token operator">:</span> <span class="token string">&#39;1062489366521&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">&#39;1:1062489366521:web:d0b8b5371a67332d1d2728&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">measurementId</span><span class="token operator">:</span> <span class="token string">&#39;G-YYE3YN0S99&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">siteKey</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_GSE_ROAR_ADMIN_APPCHECK_SITE_KEY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">debugToken</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APPCHECK_DEBUG_TOKEN</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="app-check-initialization-in-roar-firekit" tabindex="-1"><a class="header-anchor" href="#app-check-initialization-in-roar-firekit"><span>App Check Initialization in roar-firekit</span></a></h2><p>roar-firekit initializes Firebase and App Check based on the configuration provided by roar-dashboard. App Check tokens are passed as part of the configuration to ensure secure access to Firebase services.</p><h3 id="initialization-of-app-check" tabindex="-1"><a class="header-anchor" href="#initialization-of-app-check"><span>Initialization of App Check</span></a></h3><p>In roar-firekit, the App Check is initialized using the provided siteKey and debugToken:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initializeAppCheckWithRecaptcha</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  app<span class="token operator">:</span> FirebaseApp<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  siteKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> hostname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/roar-staging--pr.*-.*\.web\.app$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Use the DEBUG reCAPTCHA key for local development and PR deployments</span></span>
<span class="line">  <span class="token comment">// This allows us to bypass the reCAPTCHA domain verification</span></span>
<span class="line">  <span class="token comment">// Debug token is a private key passed in from a .env file and should not be exposed</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>hostname <span class="token operator">===</span> <span class="token string">&#39;localhost&#39;</span> <span class="token operator">||</span> regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span>self <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">FIREBASE_APPCHECK_DEBUG_TOKEN</span> <span class="token operator">=</span> debugToken<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error setting App Check debug token: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Initializing App Check with reCAPTCHA provider for project &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with site key </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>siteKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">initializeAppCheck</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ReCaptchaEnterpriseProvider</span><span class="token punctuation">(</span>siteKey <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      isTokenAutoRefreshEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error initializing App Check with reCAPTCHA provider: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="initialization-of-firebase-with-app-check" tabindex="-1"><a class="header-anchor" href="#initialization-of-firebase-with-app-check"><span>Initialization of Firebase with App Check</span></a></h3><p>In roar-firekit, Firebase is initialized with the App Check initialization function from above. The App Check token is then retrieved and passed to the roar-dashboard as <code>appCheckToken</code> for secure access to Firebase services:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initializeAppCheckWithRecaptcha</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  app<span class="token operator">:</span> FirebaseApp<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  siteKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> hostname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/roar-staging--pr.*-.*\.web\.app$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Use the DEBUG reCAPTCHA key for local development and PR deployments</span></span>
<span class="line">  <span class="token comment">// This allows us to bypass the reCAPTCHA domain verification</span></span>
<span class="line">  <span class="token comment">// Debug token is a private key passed in from a .env file and should not be exposed</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>hostname <span class="token operator">===</span> <span class="token string">&#39;localhost&#39;</span> <span class="token operator">||</span> regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span>self <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">FIREBASE_APPCHECK_DEBUG_TOKEN</span> <span class="token operator">=</span> debugToken<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error setting App Check debug token: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Initializing App Check with reCAPTCHA provider for project &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with site key </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>siteKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">initializeAppCheck</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ReCaptchaEnterpriseProvider</span><span class="token punctuation">(</span>siteKey <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      isTokenAutoRefreshEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error initializing App Check with reCAPTCHA provider: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">enum</span> AuthPersistence <span class="token punctuation">{</span></span>
<span class="line">  local <span class="token operator">=</span> <span class="token string">&#39;local&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  session <span class="token operator">=</span> <span class="token string">&#39;session&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  none <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">MarkRawConfig</span> <span class="token punctuation">{</span></span>
<span class="line">  auth<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  db<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  functions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">FirebaseProduct</span> <span class="token operator">=</span> Auth <span class="token operator">|</span> Firestore <span class="token operator">|</span> Functions <span class="token operator">|</span> FirebaseStorage<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> initializeFirebaseProject <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span></span>
<span class="line">  config<span class="token operator">:</span> FirebaseConfig<span class="token punctuation">,</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">  authPersistence <span class="token operator">=</span> AuthPersistence<span class="token punctuation">.</span>session<span class="token punctuation">,</span></span>
<span class="line">  markRawConfig<span class="token operator">:</span> MarkRawConfig <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// App Check reCAPTCHA site keys and debug token</span></span>
<span class="line">  siteKey <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  debugToken <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> optionallyMarkRaw <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">FirebaseProduct</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>productKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> productInstance<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_get</span><span class="token punctuation">(</span>markRawConfig<span class="token punctuation">,</span> productKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">markRaw</span><span class="token punctuation">(</span>productInstance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> productInstance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>config <span class="token keyword">as</span> EmulatorFirebaseConfig<span class="token punctuation">)</span><span class="token punctuation">.</span>emulatorPorts<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">initializeApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> projectId<span class="token operator">:</span> config<span class="token punctuation">.</span>projectId<span class="token punctuation">,</span> apiKey<span class="token operator">:</span> config<span class="token punctuation">.</span>apiKey <span class="token punctuation">}</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> ports <span class="token operator">=</span> <span class="token punctuation">(</span>config <span class="token keyword">as</span> EmulatorFirebaseConfig<span class="token punctuation">)</span><span class="token punctuation">.</span>emulatorPorts<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">,</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;functions&#39;</span><span class="token punctuation">,</span> <span class="token function">getFunctions</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;storage&#39;</span><span class="token punctuation">,</span> <span class="token function">getStorage</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">connectFirestoreEmulator</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> ports<span class="token punctuation">.</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">connectFunctionsEmulator</span><span class="token punctuation">(</span>functions<span class="token punctuation">,</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> ports<span class="token punctuation">.</span>functions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> originalInfo <span class="token operator">=</span> <span class="token builtin">console</span><span class="token punctuation">.</span>info<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-empty-function</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function-variable function">info</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">connectAuthEmulator</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ports<span class="token punctuation">.</span>auth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span>info <span class="token operator">=</span> originalInfo<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      firebaseApp<span class="token operator">:</span> app<span class="token punctuation">,</span></span>
<span class="line">      auth<span class="token punctuation">,</span></span>
<span class="line">      db<span class="token punctuation">,</span></span>
<span class="line">      functions<span class="token punctuation">,</span></span>
<span class="line">      storage<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">safeInitializeApp</span><span class="token punctuation">(</span>config <span class="token keyword">as</span> LiveFirebaseConfig<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Initialize App Check with reCAPTCHA provider before calling any other Firebase services</span></span>
<span class="line">    <span class="token comment">// Grab the App Check token for use in the ROAR Dashboard Axios Calls to Firebase</span></span>
<span class="line">    <span class="token keyword">const</span> appCheck <span class="token operator">=</span> <span class="token function">initializeAppCheckWithRecaptcha</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> name<span class="token punctuation">,</span> siteKey<span class="token punctuation">,</span> debugToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> appCheckToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getToken</span><span class="token punctuation">(</span>appCheck<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">,</span> <span class="token function">getAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> <span class="token function">getFirestore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;functions&#39;</span><span class="token punctuation">,</span> <span class="token function">getFunctions</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token function">optionallyMarkRaw</span><span class="token punctuation">(</span><span class="token string">&#39;storage&#39;</span><span class="token punctuation">,</span> <span class="token function">getStorage</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> performance<span class="token operator">:</span> FirebasePerformance <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      performance <span class="token operator">=</span> <span class="token function">getPerformance</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token string">&#39;performance/FB not default&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> kit <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      firebaseApp<span class="token operator">:</span> app<span class="token punctuation">,</span></span>
<span class="line">      appCheckToken<span class="token operator">:</span> appCheckToken<span class="token punctuation">.</span>token<span class="token punctuation">,</span></span>
<span class="line">      auth<span class="token operator">:</span> auth<span class="token punctuation">,</span></span>
<span class="line">      db<span class="token operator">:</span> db<span class="token punctuation">,</span></span>
<span class="line">      functions<span class="token operator">:</span> functions<span class="token punctuation">,</span></span>
<span class="line">      storage<span class="token operator">:</span> storage<span class="token punctuation">,</span></span>
<span class="line">      perf<span class="token operator">:</span> performance<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Auth state persistence is set with ``setPersistence`` and specifies how a</span></span>
<span class="line">    <span class="token comment">// user session is persisted on a device. We choose in session persistence by</span></span>
<span class="line">    <span class="token comment">// default because many students will access the ROAR on shared devices in the</span></span>
<span class="line">    <span class="token comment">// classroom.</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> browserSessionPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>local<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> browserLocalPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>authPersistence <span class="token operator">===</span> AuthPersistence<span class="token punctuation">.</span>none<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">setPersistence</span><span class="token punctuation">(</span>kit<span class="token punctuation">.</span>auth<span class="token punctuation">,</span> inMemoryPersistence<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> kit<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="manually-appending-app-check-token-to-axios-requests" tabindex="-1"><a class="header-anchor" href="#manually-appending-app-check-token-to-axios-requests"><span>Manually Appending App Check Token to Axios Requests</span></a></h2><p>Since roar-dashboard uses Axios to make requests to Firebase&#39;s REST API, the App Check token must be manually appended to each request. The App Check token is retrieved from the Roar Firekit config and passed to Axios as a header.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getAxiosInstance <span class="token operator">=</span> <span class="token punctuation">(</span>db <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> unauthenticated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> authStore <span class="token operator">=</span> <span class="token function">useAuthStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> roarfirekit <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>authStore<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> axiosOptions <span class="token operator">=</span> <span class="token function">_get</span><span class="token punctuation">(</span>roarfirekit<span class="token punctuation">.</span>value<span class="token punctuation">.</span>restConfig<span class="token punctuation">,</span> db<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Add appCheckToken to the headers if it exists in the firekit config</span></span>
<span class="line">  <span class="token keyword">const</span> appCheckToken <span class="token operator">=</span> roarfirekit<span class="token punctuation">.</span>value<span class="token punctuation">[</span>db<span class="token punctuation">]</span><span class="token operator">?.</span>appCheckToken<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>appCheckToken<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    axiosOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">...</span>axiosOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&#39;X-Firebase-AppCheck&#39;</span><span class="token operator">:</span> appCheckToken<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>unauthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">delete</span> axiosOptions<span class="token punctuation">.</span>headers<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>axiosOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><ul><li>App Check Token Retrieval: The getAppCheckToken() function in roar-firekit retrieves the current App Check token, ensuring that requests are secure.</li><li>Header Injection: The token is appended to the x-firebase-appcheck header in each Axios request to ensure it is validated by Firebase.</li></ul><p>The integration between roar-dashboard and roar-firekit ensures secure access to Firebase services using App Check. Environment variables are managed using Vite&#39;s import.meta.env, and the App Check token is manually appended to Axios requests to authenticate interactions with Firebase&#39;s REST API. This setup allows for both secure and flexible handling of Firebase services across different environments.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/yeatmanlab//edit/main/firebase-app-check/README.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ksmontville@gmail.com">Kyle</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/roar-docs/dashboard-components/" aria-label="Dashboard Components"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Dashboard Components</span></div></a><a class="route-link auto-link next" href="/roar-docs/cloud-functions/" aria-label="Cloud Functions"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Cloud Functions</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/roar-docs/assets/app-CZL5WUHD.js" defer></script>
  </body>
</html>
